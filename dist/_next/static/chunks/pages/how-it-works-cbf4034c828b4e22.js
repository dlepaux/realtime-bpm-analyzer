(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[640],{6903:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/how-it-works",function(){return n(1225)}])},1225:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return _}});var r=n(5666),i=n.n(r),a=n(5893),o=n(682),s=n(7294),l=n(9008),c=n(4087),u=n.n(c),h=n(6616);function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e){return!e||"object"!==w(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(l){i=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var w=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function m(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d(t);if(e){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p(this,n)}}var S=100,b=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(o,t);var e,n,r,i=m(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,t)).canvas=s.createRef(),e.bufferLength=t.bufferLength,e.dataArray=t.dataArray,e.showThreshold=t.showThreshold,e.threshold=t.threshold,e.bpm=t.bpm,e.state={parentWidth:200},e}return e=o,(n=[{key:"componentDidMount",value:function(){this.setState({parentWidth:this.canvas.current.parentNode.offsetWidth})}},{key:"componentDidUpdate",value:function(t){this.bufferLength=t.bufferLength,this.dataArray=t.dataArray,this.threshold=t.threshold,this.bpm=t.bpm}},{key:"drawPcmGraph",value:function(){var t=this.canvas.current.getContext("2d"),e=this.canvas.current.parentNode.offsetWidth;if(t.clearRect(0,0,e,S),t.font="10px Courier New",t.fillStyle="white",!0===this.showThreshold?t.fillText("LowPass Signal",4,10):t.fillText("Original Signal",4,10),null!==this.threshold&&!0===this.showThreshold){var n=S*(1-this.threshold);t.beginPath(),t.moveTo(0,n),t.lineTo(e,n),t.lineWidth=1,t.strokeStyle="red",t.stroke(),t.font="bold 10px Courier New",t.fillStyle="red",t.fillText(this.threshold.toFixed(2),4,n-4);var r="BPM ".concat(this.bpm);t.fillText(r,e-t.measureText(r).width-4,n-4)}var i=e/this.bufferLength,a=!0,o=!1,s=void 0;try{for(var l,c=this.dataArray.entries()[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=y(l.value,2),h=u[0],f=u[1],d=S-S*(f/256)-1;t.fillStyle="white",t.fillRect(h*i,d,i,1)}}catch(p){o=!0,s=p}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}}},{key:"render",value:function(){return(0,a.jsx)("div",{className:"canvas-container bg-dark",children:(0,a.jsx)("canvas",{ref:this.canvas,height:S,width:this.state.parentWidth})})}}])&&f(e.prototype,n),r&&f(e,r),o}(s.Component),v=n(6308);function x(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function P(t,e,n,r,i,a,o){try{var s=t[a](o),l=s.value}catch(c){return void n(c)}s.done?e(l):Promise.resolve(l).then(r,i)}function j(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){P(a,r,i,o,s,"next",t)}function s(t){P(a,r,i,o,s,"throw",t)}o(void 0)}))}}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function T(t,e){return!e||"object"!==N(e)&&"function"!==typeof e?x(t):e}function B(t,e){return(B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var N=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function C(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=k(t);if(e){var i=k(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return T(this,n)}}var _=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}(f,t);var e,n,r,c=C(f);function f(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),(e=c.call(this,t)).originalSignal=s.createRef(),e.lowPassSignal=s.createRef(),e.scriptProcessorNode=null,e.realTimeBPMAnalyzer=null,e.originalSignalAnalyzer=null,e.lowPassSignalAnalyzer=null,e.originalSignalSource=null,e.lowPassSignalSource=null,e.timeout=null,e.state={start:!1,originalSignalDataArray:null,lowPassSignalDataArray:null,currentThreshold:0,currentBpm:0},e.toggleStart=e.toggleStart.bind(x(e)),e.onAudioProcess=e.onAudioProcess.bind(x(e)),e}return e=f,(n=[{key:"loadSound",value:function(t){var e=this,n=new window.XMLHttpRequest;return n.open("GET",t,!0),n.responseType="arraybuffer",new Promise((function(t,r){var i=e;n.addEventListener("load",(function(){i.audioContext.decodeAudioData(n.response,t,r)})),n.send()}))}},{key:"onEnded",value:function(){return j(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.audioContext.suspend();case 2:this.setState({start:!1}),this.setState({currentThreshold:0}),this.setState({currentBpm:0});case 5:case"end":return t.stop()}}),t,this)})).bind(this))()}},{key:"toggleStart",value:function(){return j(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.audioContext=this.audioContext||v.kq(),this.setState((function(t){return t.start=!t.start,t})),t.next=4,this.audioContext.resume();case 4:this.state.start?this.analyzeBpm():this.stopAnalyzer();case 5:case"end":return t.stop()}}),t,this)})).bind(this))()}},{key:"onAudioProcess",value:function(t){var e=this;this.realTimeBPMAnalyzer.analyze(t),u()((function(){e.originalSignalAnalyzer.getByteTimeDomainData(e.state.originalSignalDataArray),e.lowPassSignalAnalyzer.getByteTimeDomainData(e.state.lowPassSignalDataArray),e.setState((function(t){return t})),e.originalSignal.current.drawPcmGraph(),e.lowPassSignal.current.drawPcmGraph()}))}},{key:"analyzeBpm",value:function(){return j(i().mark((function t(){var e,n,r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this,n=this,this.originalSignalSource=this.audioContext.createBufferSource(),this.lowPassSignalSource=this.audioContext.createBufferSource(),this.originalSignalAnalyzer=this.audioContext.createAnalyser(),this.lowPassSignalAnalyzer=this.audioContext.createAnalyser(),this.scriptProcessorNode=this.audioContext.createScriptProcessor(2048,1,1),this.originalSignalBufferLength=this.originalSignalAnalyzer.frequencyBinCount,this.lowPassSignalBufferLength=this.lowPassSignalAnalyzer.frequencyBinCount,this.setState({originalSignalDataArray:new Uint8Array(this.originalSignalBufferLength)}),this.setState({lowPassSignalDataArray:new Uint8Array(this.lowPassSignalBufferLength)}),this.originalSignalSource.connect(this.audioContext.destination),this.lowPassSignalSource.connect(this.audioContext.destination),this.filter=this.audioContext.createBiquadFilter(),this.filter.type="lowpass",this.lowPassSignalSource.connect(this.filter),this.filter.connect(this.lowPassSignalAnalyzer),this.originalSignalSource.connect(this.originalSignalAnalyzer),this.lowPassSignalAnalyzer.connect(this.scriptProcessorNode),this.scriptProcessorNode.connect(this.audioContext.destination),this.realTimeBPMAnalyzer=new h.Y({debug:!0,scriptNode:{bufferSize:2048},pushTime:2e3,pushCallback:function(t,n,r){t?console.warn(t):(e.setState({currentThreshold:r}),e.setState({currentBpm:n[0].tempo}))}}),this.scriptProcessorNode.addEventListener("audioprocess",this.onAudioProcess),t.next=23,this.loadSound(v.WV);case 23:r=t.sent,this.playSound(r),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){n.onEnded()}),1e3*r.duration);case 27:case"end":return t.stop()}}),t,this)})).bind(this))()}},{key:"playSound",value:function(t){this.originalSignalSource.buffer=t,this.lowPassSignalSource.buffer=t,this.originalSignalSource.start(0),this.lowPassSignalSource.start(0)}},{key:"stopAnalyzer",value:function(){return j(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.audioContext.suspend();case 2:this.scriptProcessorNode.removeEventListener("audioprocess",this.onAudioProcess),this.filter.disconnect(),this.originalSignalSource.disconnect(),this.lowPassSignalSource.disconnect(),this.scriptProcessorNode.disconnect(),this.originalSignalAnalyzer.disconnect(),this.lowPassSignalAnalyzer.disconnect(),this.setState({start:!1}),this.setState({currentThreshold:0}),this.setState({currentBpm:0}),this.realTimeBPMAnalyzer=null;case 13:case"end":return t.stop()}}),t,this)})).bind(this))()}},{key:"render",value:function(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.default,{children:[(0,a.jsx)("title",{children:"How it works ? | Realtime Bpm Analyzer"}),(0,a.jsx)("meta",{name:"description",content:"Experiment showing how the algorithm works"})]}),(0,a.jsxs)(o.Z,{className:"mt-3",children:[(0,a.jsx)("h1",{children:"How it works"}),(0,a.jsx)("p",{className:"lead",children:"This experiment will show how the analyzer is working to compute BPM (Beats Per Minute)."}),(0,a.jsx)("hr",{}),(0,a.jsx)("p",{className:"alert alert-info",children:"Press the button below to start the analyzer. You will be able to see how it's working during an analysis. This experiment shows the original signal and the lowpass ones."}),(0,a.jsx)("div",{className:"text-center mb-3",children:(0,a.jsxs)("div",{className:"btn-group",children:[(0,a.jsxs)("button",{type:"button",className:"btn btn-primary",disabled:this.state.start,onClick:this.toggleStart,children:[(0,a.jsx)("i",{className:"bi bi-play-circle"})," Start"]}),(0,a.jsxs)("button",{type:"button",className:"btn btn-dark",disabled:!this.state.start,onClick:this.toggleStart,children:[(0,a.jsx)("i",{className:"bi bi-stop-circle"})," Stop"]})]})})]}),(0,a.jsx)(b,{ref:this.originalSignal,bufferLength:this.originalSignalBufferLength,dataArray:this.state.originalSignalDataArray,className:"mb-3"}),(0,a.jsx)(o.Z,{children:(0,a.jsxs)("p",{className:"pt-3",children:["The ",(0,a.jsx)("strong",{children:"original signal"})," is actually ",(0,a.jsx)("a",{href:"https://en.wikipedia.org/wiki/Pulse-code_modulation",children:"PCM (Pulse-Code Modulation)"})," data. See also ",(0,a.jsx)("a",{href:"https://en.wikipedia.org/wiki/Digital_audio",children:"Digital Audio"})," for more information.",(0,a.jsx)("br",{})]})}),(0,a.jsx)(b,{ref:this.lowPassSignal,showThreshold:!0,bufferLength:this.lowPassSignalBufferLength,dataArray:this.state.lowPassSignalDataArray,threshold:this.state.currentThreshold,bpm:this.state.currentBpm,className:"mb-3"}),(0,a.jsxs)(o.Z,{children:[(0,a.jsx)("section",{className:"pt-3",children:(0,a.jsxs)("p",{children:["The ",(0,a.jsx)("strong",{children:"lowpass signal"})," is the same signal as the original one with a low pass filter applied on it.",(0,a.jsx)("br",{}),"To compute the ",(0,a.jsx)("strong",{children:"beats per minute"})," we are trying to find a minimum of 15 peaks at all thresholds (between 0.90 and 0.30) with a step of 0.05 (0.30, 0.35, 0.40 and so on...). We start from the lowest one to the highest because we have more chances (at the begining to find more occurences).",(0,a.jsx)("br",{}),"Once we have a ",(0,a.jsx)("i",{children:"valid"})," threshold, we keep looking for better ones (higher)."]})}),(0,a.jsxs)("p",{className:"alert alert-warning mb-5",children:["TODO: Illustrate the Joe Sullivan's diagram with all ",(0,a.jsx)("i",{children:"matches"})," at all available threshold"]})]})]})}}])&&A(e.prototype,n),r&&A(e,r),f}(s.Component)}},function(t){t.O(0,[892,774,888,179],(function(){return e=6903,t(t.s=e);var e}));var e=t.O();_N_E=e}]);