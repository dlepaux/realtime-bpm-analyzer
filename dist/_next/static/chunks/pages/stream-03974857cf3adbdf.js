(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[245],{1954:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stream",function(){return n(7754)}])},2963:function(e,t,n){"use strict";var a=n(5893),r=n(7294);function i(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return!t||"object"!==l(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=s(e);if(t){var r=s(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return o(this,n)}}var h=100,f=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(l,e);var t,n,s,o=u(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e)).canvas=r.createRef(),t.bufferLength=e.bufferLength,t.dataArray=e.dataArray,t.state={parentWidth:200},t}return t=l,(n=[{key:"componentDidMount",value:function(){this.setState({parentWidth:this.canvas.current.parentNode.offsetWidth})}},{key:"componentDidUpdate",value:function(e){var t=e.bufferLength,n=e.dataArray;this.bufferLength=t,this.dataArray=n}},{key:"drawFrequencyBarGraph",value:function(){console.log("drawFrequencyBarGraph");var e=this.canvas.current.getContext("2d"),t=this.canvas.current.parentNode.offsetWidth;e.clearRect(0,0,t,h),e.fillStyle="#212529",e.fillRect(0,0,t,h);for(var n,a=t/this.bufferLength*2.5,r=0,i=0;i<this.bufferLength;i++)n=this.dataArray[i]/2,e.fillStyle="rgba(100, 206, 170, ".concat((n/h).toFixed(2),")"),e.fillRect(r,h-n/2,a,n),r+=a+1}},{key:"render",value:function(){return(0,a.jsx)("div",{className:"canvas-container bg-dark",children:(0,a.jsx)("canvas",{ref:this.canvas,height:h,width:this.state.parentWidth})})}}])&&i(t.prototype,n),s&&i(t,s),l}(r.Component);t.Z=f},7754:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return z}});var a=n(5666),r=n.n(a),i=n(5893),s=n(682),o=n(7294),c=n(9008),l=n(4087),u=n.n(l),h=n(6616),f=n(2963),d=n(6308);function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,n,a,r,i,s){try{var o=e[i](s),c=o.value}catch(l){return void n(l)}o.done?t(c):Promise.resolve(c).then(a,r)}function y(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function s(e){p(i,a,r,s,o,"next",e)}function o(e){p(i,a,r,s,o,"throw",e)}s(void 0)}))}}function b(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return!t||"object"!==j(t)&&"function"!==typeof t?m(e):t}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var j=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=v(e);if(t){var r=v(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return x(this,n)}}var z=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(p,e);var t,n,a,l=P(p);function p(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=l.call(this,e)).analyzer=null,t.bufferLength=null,t.audioContext=null,t.source=null,t.scriptProcessorNode=null,t.realTimeBPMAnalyzer=null,t.state={isAnalyzing:!1,dataArray:null,defaultStreamEndpoint:"https://ssl1.viastreaming.net:7005/;listen.mp3",computeBPMDelay:5e3,stabilizationTime:1e4,pushTime:1e3,currentTempo:0},t.music=o.createRef(null),t.graph=o.createRef(null),t.analyzeBpm=t.analyzeBpm.bind(m(t)),t.onAudioProcess=t.onAudioProcess.bind(m(t)),t.onChangeStreamEndpoint=t.onChangeStreamEndpoint.bind(m(t)),t.onChangePushTime=t.onChangePushTime.bind(m(t)),t.onChangeComputeBPMDelay=t.onChangeComputeBPMDelay.bind(m(t)),t.onChangeStabilizationTime=t.onChangeStabilizationTime.bind(m(t)),t}return t=p,(n=[{key:"analyzeBpm",value:function(){return y(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,!this.state.isAnalyzing){e.next=3;break}return e.abrupt("return");case 3:return this.audioContext=this.audioContext||d.kq(),e.next=6,this.audioContext.resume();case 6:this.setState({isAnalyzing:!0}),this.analyzer=this.audioContext.createAnalyser(),this.analyzer.fftSize=1024,this.bufferLength=this.analyzer.frequencyBinCount,this.setState({dataArray:new Uint8Array(this.bufferLength)}),this.source=this.source||this.audioContext.createMediaElementSource(this.music.current),this.scriptProcessorNode=this.audioContext.createScriptProcessor(4096,1,1),this.source.connect(this.analyzer),this.scriptProcessorNode.connect(this.audioContext.destination),this.source.connect(this.scriptProcessorNode),this.source.connect(this.audioContext.destination),this.realTimeBPMAnalyzer=new h.Y({debug:!0,scriptNode:{bufferSize:4096},computeBPMDelay:this.state.computeBPMDelay,stabilizationTime:this.state.stabilizationTime,continuousAnalysis:!0,pushTime:this.state.pushTime,pushCallback:function(e,n){e?console.warn(e):"undefined"!==typeof n[0]&&t.setState({currentTempo:n[0].tempo})}}),this.scriptProcessorNode.addEventListener("audioprocess",this.onAudioProcess),this.music.current.play();case 20:case"end":return e.stop()}}),e,this)})).bind(this))()}},{key:"onAudioProcess",value:function(e){var t=this;this.realTimeBPMAnalyzer.analyze(e),u()((function(){t.analyzer.getByteFrequencyData(t.state.dataArray),t.setState((function(e){return e})),t.graph.current.drawFrequencyBarGraph()}))}},{key:"onChangeStreamEndpoint",value:function(e){this.setState({defaultStreamEndpoint:e.target.value}),this.restartAnalyzer()}},{key:"onChangePushTime",value:function(e){this.setState({pushTime:e.target.value}),this.restartAnalyzer()}},{key:"onChangeComputeBPMDelay",value:function(e){this.setState({computeBPMDelay:e.target.value}),this.restartAnalyzer()}},{key:"onChangeStabilizationTime",value:function(e){this.setState({stabilizationTime:e.target.value}),this.restartAnalyzer()}},{key:"restartAnalyzer",value:function(){return y(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.isAnalyzing){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.audioContext.suspend();case 4:this.source.disconnect(),this.scriptProcessorNode.disconnect(),this.analyzer.disconnect(),this.setState({isAnalyzing:!1}),this.scriptProcessorNode.removeEventListener("audioprocess",this.onAudioProcess),this.realTimeBPMAnalyzer=null,this.setState({currentTempo:0}),this.analyzeBpm();case 12:case"end":return e.stop()}}),e,this)})).bind(this))()}},{key:"render",value:function(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(c.default,{children:[(0,i.jsx)("title",{children:"Stream usage example | Realtime Bpm Analyzer"}),(0,i.jsx)("meta",{name:"description",content:"Example using the Realtime BPM Analyzer on a stream. This example allows you to test any stream and configure the analyzer."})]}),(0,i.jsxs)(s.Z,{className:"pt-3",children:[(0,i.jsx)("h1",{children:"Stream"}),(0,i.jsxs)("div",{className:"lead",children:["Exemple of the usage of the analyzer with a ",(0,i.jsx)("code",{children:"Stream"}),"."]}),(0,i.jsx)("hr",{}),(0,i.jsx)("audio",{ref:this.music,controls:!0,src:this.state.defaultStreamEndpoint,crossOrigin:"anonymous",className:"w-100"}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)("p",{className:"text-center",children:(0,i.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",disabled:this.state.isAnalyzing,onClick:this.analyzeBpm,children:[(0,i.jsx)("i",{className:"bi bi-play-circle"})," Play and Analyze BPM"]})})})]}),(0,i.jsx)(f.Z,{ref:this.graph,bufferLength:this.bufferLength,dataArray:this.state.dataArray}),(0,i.jsx)(s.Z,{className:"pt-3",children:(0,i.jsxs)("div",{className:"row mt-3 mb-3",children:[(0,i.jsx)("div",{className:"col-md-6 col-sm-12",children:(0,i.jsxs)("form",{children:[(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{htmlFor:"streamEndpoint",className:"form-label",children:"Stream Endpoint"}),(0,i.jsx)("input",{type:"text",className:"form-control",id:"streamEndpoint","aria-describedby":"streamEndpointDescription",value:this.state.defaultStreamEndpoint,onChange:this.onChangeStreamEndpoint}),(0,i.jsxs)("div",{id:"streamEndpointDescription",className:"form-text",children:["Stream endpoint analyzed by the library. The default value is a stream from ",(0,i.jsx)("a",{href:"https://ibizasonica.com/",children:"IbizaSonica Radio"})," \u2665."]})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsxs)("label",{htmlFor:"pushTime",className:"form-label",children:["Push Time (",this.state.pushTime," milliseconds)"]}),(0,i.jsx)("input",{type:"range",className:"form-range",min:"100",max:"5000",step:"100",id:"pushTime","aria-describedby":"pushTimeDescription",value:this.state.pushTime,onChange:this.onChangePushTime}),(0,i.jsxs)("div",{id:"pushTimeDescription",className:"form-text",children:["BPM will be computed at each tick of ",this.state.pushTime," milliseconds."]})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsxs)("label",{htmlFor:"computeBPMDelay",className:"form-label",children:["Compute BPM Delay (",this.state.computeBPMDelay," milliseconds)"]}),(0,i.jsx)("input",{type:"range",className:"form-range",min:"1000",max:"20000",step:"1000",id:"computeBPMDelay","aria-describedby":"computeBPMDelayDescription",value:this.state.computeBPMDelay,onChange:this.onChangeComputeBPMDelay}),(0,i.jsx)("div",{id:"computeBPMDelayDescription",className:"form-text",children:"BPM computation will start after this delay."})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsxs)("label",{htmlFor:"stabilizationTime",className:"form-label",children:["Stabilization Time (",this.state.stabilizationTime," milliseconds)"]}),(0,i.jsx)("input",{type:"range",className:"form-range",min:"10000",max:"60000",step:"1000",id:"stabilizationTime","aria-describedby":"stabilizationTimeDescription",value:this.state.stabilizationTime,onChange:this.onChangeStabilizationTime}),(0,i.jsx)("div",{id:"stabilizationTimeDescription",className:"form-text",children:"BPM will be considered as stable after this time."})]})]})}),(0,i.jsx)("div",{className:"col-md-6 col-sm-12",children:(0,i.jsx)("div",{className:"d-flex h-100 align-items-start justify-content-center",children:(0,i.jsx)("div",{className:"card bg-dark mb-3",children:(0,i.jsx)("div",{className:"card-body text-center",children:(0,i.jsxs)("span",{className:"display-6",children:["Current BPM ",(0,i.jsx)("span",{children:this.state.currentTempo}),(0,i.jsx)("br",{}),(0,i.jsx)("i",{className:"bi bi-soundwave"})]})})})})})]})})]})}}])&&b(t.prototype,n),a&&b(t,a),p}(o.Component)}},function(e){e.O(0,[892,774,888,179],(function(){return t=1954,e(e.s=t);var t}));var t=e.O();_N_E=t}]);