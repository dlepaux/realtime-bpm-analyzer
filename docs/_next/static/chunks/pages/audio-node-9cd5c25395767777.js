(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[349],{3495:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/audio-node",function(){return n(2896)}])},2896:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var r=n(4111),s=n(7568),a=n(1438),o=n(2951),i=n(8029),c=n(460),l=n(655),d=n(5893),u=n(682),p=n(6518),h=n(7294),m=n(9008),x=n.n(m),f=n(4087),y=n.n(f),b=n(6174),g=n(2963),N=n(6308),j=function(e){(0,i.Z)(n,e);var t=(0,c.Z)(n);function n(e){var s;return(0,a.Z)(this,n),(s=t.call(this,e)).music=h.createRef(null),s.graph=h.createRef(null),s.analyzer=null,s.bufferLength=null,s.audioContext=null,s.filter=null,s.source=null,s.scriptProcessorNode=null,s.realtimeAnalyzerNode=null,s.state={open:!1,isAnalyzing:!1,dataArray:null,currentTempo:0},s.onEnded=s.onEnded.bind((0,r.Z)(s)),s.analyzeBpm=s.analyzeBpm.bind((0,r.Z)(s)),s.toggleCollapse=s.toggleCollapse.bind((0,r.Z)(s)),s}return(0,o.Z)(n,[{key:"analyzeBpm",value:function(){var e=this;return(0,s.Z)((function(){var t;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),e.state.isAnalyzing?[2]:(e.audioContext=e.audioContext||N.kq(),e.scriptProcessorNode=e.audioContext.createScriptProcessor(4096,1,1),[4,e.audioContext.resume()]);case 1:return n.sent(),[4,(0,b.q)(e.audioContext).catch((function(e){return console.log(e)}))];case 2:return e.realtimeAnalyzerNode=n.sent(),e.setState({isAnalyzing:!0}),e.music.current.addEventListener("ended",e.onEnded.bind(e)),e.analyzer=e.audioContext.createAnalyser(),e.analyzer.fftSize=1024,e.bufferLength=e.analyzer.frequencyBinCount,e.setState({dataArray:new Uint8Array(e.bufferLength)}),e.source=e.source||e.audioContext.createMediaElementSource(e.music.current),e.filter=e.audioContext.createBiquadFilter(),e.filter.type="lowpass",e.source.connect(e.filter).connect(e.realtimeAnalyzerNode),e.source.connect(e.analyzer),e.scriptProcessorNode.connect(e.audioContext.destination),e.source.connect(e.scriptProcessorNode),e.source.connect(e.audioContext.destination),e.realtimeAnalyzerNode.port.addEventListener("message",e.onMessage.bind(e)),e.realtimeAnalyzerNode.port.start(),e.scriptProcessorNode.addEventListener("audioprocess",e.onAudioProcess.bind(e)),e.music.current.play(),[3,4];case 3:return t=n.sent(),console.error(t),[3,4];case 4:return[2]}}))}))()}},{key:"onEnded",value:function(){var e=this;return(0,s.Z)((function(){return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.audioContext.suspend()];case 1:return t.sent(),e.source.disconnect(),e.scriptProcessorNode.disconnect(),e.realtimeAnalyzerNode.disconnect(),e.analyzer.disconnect(),e.filter.disconnect(),e.setState({isAnalyzing:!1}),e.scriptProcessorNode.removeEventListener("audioprocess",e.onAudioProcess),e.setState({currentTempo:0}),[2]}}))}))()}},{key:"onMessage",value:function(e){"BPM"===e.data.message&&e.data.result.bpm.length>0&&this.setState({currentTempo:e.data.result.bpm[0].tempo})}},{key:"onAudioProcess",value:function(){var e=this;y()((function(){e.analyzer.getByteFrequencyData(e.state.dataArray),e.setState((function(e){return e})),e.graph.current.drawFrequencyBarGraph()}))}},{key:"toggleCollapse",value:function(){this.setState((function(e){return e.open=!e.open,e}))}},{key:"render",value:function(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(x(),{children:[(0,d.jsx)("title",{children:"AudioNode usage example | Realtime Bpm Analyzer"}),(0,d.jsx)("meta",{name:"description",content:"Example using the Realtime BPM Analyzer on an audio node."})]}),(0,d.jsxs)(u.Z,{className:"pt-3",children:[(0,d.jsx)("h1",{children:"Audio Node"}),(0,d.jsxs)("div",{className:"lead",children:["Exemple of the usage of the analyzer with an ",(0,d.jsx)("code",{children:"<audio>"})," node."]}),(0,d.jsx)("hr",{}),(0,d.jsx)("audio",{ref:this.music,controls:!0,src:N.WV,className:"w-100",onEnded:this.onEnded}),(0,d.jsxs)("div",{className:"pt-2",children:[(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",disabled:this.state.isAnalyzing,onClick:this.analyzeBpm,children:[(0,d.jsx)("i",{className:"bi bi-play-circle"})," Detect BPM from audio node"]}),(0,d.jsx)("br",{}),(0,d.jsx)("small",{className:"text-muted","aria-expanded":this.state.open,"aria-controls":"help",onClick:this.toggleCollapse,children:"More info"})]}),(0,d.jsx)(p.Z,{in:this.state.open,children:(0,d.jsx)("div",{id:"help",children:(0,d.jsxs)("p",{className:"alert alert-dark",children:["Start the experiment by clicking the button above, it will play and analyze the music sample.",(0,d.jsx)("br",{}),"A stable and robust result will be provided after couple of seconds and is expected to be around ",(0,d.jsx)("strong",{children:"131"})," beats per minute."]})})})]})]}),(0,d.jsx)(g.Z,{ref:this.graph,bufferLength:this.bufferLength,dataArray:this.state.dataArray}),(0,d.jsx)(u.Z,{children:(0,d.jsx)("div",{className:"d-flex justify-content-center pt-5 pb-5",children:(0,d.jsx)("div",{className:"card bg-dark col-lg-6 col-md-8 col-sm-10",children:(0,d.jsx)("div",{className:"card-body text-center",children:(0,d.jsxs)("span",{className:"display-6",children:["Current BPM ",(0,d.jsx)("span",{children:this.state.currentTempo}),(0,d.jsx)("br",{}),(0,d.jsx)("i",{className:"bi bi-soundwave"}),(0,d.jsx)("br",{}),(0,d.jsx)("span",{className:"text-muted",children:"Expected BPM 131"})]})})})})})]})}}]),n}(h.Component)}},function(e){e.O(0,[521,774,888,179],(function(){return t=3495,e(e.s=t);var t}));var t=e.O();_N_E=t}]);