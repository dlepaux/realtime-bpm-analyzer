(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[349],{8948:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/audio-node",function(){return n(2896)}])},2963:function(e,t,n){"use strict";var r=n(5893),o=n(7294);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return!t||"object"!==u(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=a(e);if(t){var o=a(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}var f=100,d=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(u,e);var t,n,a,s=l(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=s.call(this,e)).canvas=o.createRef(),t.bufferLength=e.bufferLength,t.dataArray=e.dataArray,t.state={parentWidth:200},t}return t=u,(n=[{key:"componentDidMount",value:function(){this.setState({parentWidth:this.canvas.current.parentNode.offsetWidth})}},{key:"componentDidUpdate",value:function(e){var t=e.bufferLength,n=e.dataArray;this.bufferLength=t,this.dataArray=n}},{key:"drawFrequencyBarGraph",value:function(){console.log("drawFrequencyBarGraph");var e=this.canvas.current.getContext("2d"),t=this.canvas.current.parentNode.offsetWidth;e.clearRect(0,0,t,f),e.fillStyle="#212529",e.fillRect(0,0,t,f);for(var n,r=t/this.bufferLength*2.5,o=0,i=0;i<this.bufferLength;i++)n=this.dataArray[i]/2,e.fillStyle="rgba(100, 206, 170, ".concat((n/f).toFixed(2),")"),e.fillRect(o,f-n/2,r,n),o+=r+1}},{key:"render",value:function(){return(0,r.jsx)("div",{className:"canvas-container bg-dark",children:(0,r.jsx)("canvas",{ref:this.canvas,height:f,width:this.state.parentWidth})})}}])&&i(t.prototype,n),a&&i(t,a),u}(o.Component);t.Z=d},2896:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var r=n(5666),o=n.n(r),i=n(5893),a=n(682),s=n(6518),c=n(7294),u=n(9008),l=n(4087),f=n.n(l),d=n(6616),h=n(2963),p=n(6308);function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,o)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){b(i,r,o,a,s,"next",e)}function s(e){b(i,r,o,a,s,"throw",e)}a(void 0)}))}}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return!t||"object"!==w(t)&&"function"!==typeof t?y(e):t}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=x(e);if(t){var o=x(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return g(this,n)}}var N=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(b,e);var t,n,r,l=P(b);function b(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b),(t=l.call(this,e)).music=c.createRef(null),t.graph=c.createRef(null),t.audioContext=null,t.analyzer=null,t.bufferLength=null,t.source=null,t.scriptProcessorNode=null,t.realTimeBPMAnalyzer=null,t.state={open:!1,isAnalyzing:!1,dataArray:null,currentTempo:0},t.analyzeBpm=t.analyzeBpm.bind(y(t)),t.toggleCollapse=t.toggleCollapse.bind(y(t)),t}return t=b,(n=[{key:"analyzeBpm",value:function(){return m(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,!this.state.isAnalyzing){e.next=3;break}return e.abrupt("return");case 3:return this.audioContext=this.audioContext||p.kq(),e.next=6,this.audioContext.resume();case 6:this.setState({isAnalyzing:!0}),this.music.current.addEventListener("ended",this.onEnded.bind(this)),this.analyzer=this.audioContext.createAnalyser(),this.analyzer.fftSize=1024,this.bufferLength=this.analyzer.frequencyBinCount,this.setState({dataArray:new Uint8Array(this.bufferLength)}),this.source=this.source||this.audioContext.createMediaElementSource(this.music.current),this.scriptProcessorNode=this.audioContext.createScriptProcessor(4096,1,1),this.source.connect(this.analyzer),this.scriptProcessorNode.connect(this.audioContext.destination),this.source.connect(this.scriptProcessorNode),this.source.connect(this.audioContext.destination),this.realTimeBPMAnalyzer=new d.Y({debug:!0,scriptNode:{bufferSize:4096},pushTime:1e3,pushCallback:function(e,n){e?console.warn(e):"undefined"!==typeof n[0]&&t.setState({currentTempo:n[0].tempo})}}),this.scriptProcessorNode.addEventListener("audioprocess",this.onAudioProcess.bind(this)),this.music.current.play();case 21:case"end":return e.stop()}}),e,this)})).bind(this))()}},{key:"onEnded",value:function(){return m(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.audioContext.suspend();case 2:this.source.disconnect(),this.scriptProcessorNode.disconnect(),this.analyzer.disconnect(),this.setState({isAnalyzing:!1}),this.scriptProcessorNode.removeEventListener("audioprocess",this.onAudioProcess),this.realTimeBPMAnalyzer=null,this.setState({currentTempo:0});case 9:case"end":return e.stop()}}),e,this)})).bind(this))()}},{key:"onAudioProcess",value:function(e){var t=this;this.realTimeBPMAnalyzer.analyze(e),f()((function(){t.analyzer.getByteFrequencyData(t.state.dataArray),t.setState((function(e){return e})),t.graph.current.drawFrequencyBarGraph()}))}},{key:"toggleCollapse",value:function(){this.setState((function(e){return e.open=!e.open,e}))}},{key:"render",value:function(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.default,{children:[(0,i.jsx)("title",{children:"AudioNode usage example | Realtime Bpm Analyzer"}),(0,i.jsx)("meta",{name:"description",content:"Example using the Realtime BPM Analyzer on an audio node."})]}),(0,i.jsxs)(a.Z,{className:"pt-3",children:[(0,i.jsx)("h1",{children:"Audio Node"}),(0,i.jsxs)("div",{className:"lead",children:["Exemple of the usage of the analyzer with an ",(0,i.jsx)("code",{children:"<audio>"})," node."]}),(0,i.jsx)("hr",{}),(0,i.jsx)("audio",{ref:this.music,controls:!0,src:p.WV,className:"w-100"}),(0,i.jsxs)("div",{className:"pt-2",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",disabled:this.state.isAnalyzing,onClick:this.analyzeBpm,onEnded:this.onEnded,children:[(0,i.jsx)("i",{className:"bi bi-play-circle"})," Detect BPM from audio node"]}),(0,i.jsx)("br",{}),(0,i.jsx)("small",{className:"text-muted","aria-expanded":this.state.open,"aria-controls":"help",onClick:this.toggleCollapse,children:"More info"})]}),(0,i.jsx)(s.Z,{in:this.state.open,children:(0,i.jsx)("div",{id:"help",children:(0,i.jsxs)("p",{className:"alert alert-dark",children:["Start the experiment by clicking the button above, it will play and analyze the music sample.",(0,i.jsx)("br",{}),"A stable and robust result will be provided after couple of seconds and is expected to be around ",(0,i.jsx)("strong",{children:"131"})," beats per minute."]})})})]})]}),(0,i.jsx)(h.Z,{ref:this.graph,bufferLength:this.bufferLength,dataArray:this.state.dataArray}),(0,i.jsx)(a.Z,{children:(0,i.jsx)("div",{className:"d-flex justify-content-center pt-5 pb-5",children:(0,i.jsx)("div",{className:"card bg-dark col-lg-6 col-md-8 col-sm-10",children:(0,i.jsx)("div",{className:"card-body text-center",children:(0,i.jsxs)("span",{className:"display-6",children:["Current BPM ",(0,i.jsx)("span",{children:this.state.currentTempo}),(0,i.jsx)("br",{}),(0,i.jsx)("i",{className:"bi bi-soundwave"}),(0,i.jsx)("br",{}),(0,i.jsx)("span",{className:"text-muted",children:"Expected BPM 131"})]})})})})})]})}}])&&v(t.prototype,n),r&&v(t,r),b}(c.Component)}},function(e){e.O(0,[892,774,888,179],(function(){return t=8948,e(e.s=t);var t}));var t=e.O();_N_E=t}]);