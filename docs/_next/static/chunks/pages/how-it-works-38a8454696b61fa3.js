(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[640],{3454:function(e,t,n){"use strict";var r,o;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"===typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(7663)},6929:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/how-it-works",function(){return n(2480)}])},6308:function(e,t,n){"use strict";n.d(t,{Do:function(){return i},WV:function(){return o},kq:function(){return r},pM:function(){return l},vb:function(){return s},w9:function(){return a}});var r=function(){return new(window.AudioContext||window.mozAudioContext||window.webkitAudioContext)},o="".concat("/realtime-bpm-analyzer","/media/new_order-blue_monday.mp3"),i="npm install realtime-bpm-analyzer",a='<audio src="'.concat("/realtime-bpm-analyzer",'/media/new_order-blue_monday.mp3" id="music"></audio>'),s="// Create new instance of AudioContext\nconst audioContext = new AudioContext();\n// Set the source with the HTML Audio Node\nconst source = audioContext.createMediaElementSource(document.getElementById('music'));\n// Set the scriptProcessorNode to get PCM data in real time\nconst scriptProcessorNode = audioContext.createScriptProcessor(4096, 1, 1);\n// Connect everythings together\nscriptProcessorNode.connect(audioContext.destination);\nsource.connect(scriptProcessorNode);\nsource.connect(audioContext.destination);\n",l="import {RealTimeBPMAnalyzer} from 'realtime-bpm-analyzer';\n\nconst realTimeBPMAnalyzer = new RealTimeBPMAnalyzer({\n  scriptNode: {\n    bufferSize: 4096\n  },\n  pushTime: 2000,\n  pushCallback: (err, bpm) => {\n    console.log('bpm', bpm);\n  }\n});\n\n// Attach realTime function to audioprocess event.inputBuffer (AudioBuffer)\nscriptProcessorNode.addEventListener('audioprocess', event => {\n  realTimeBPMAnalyzer.analyze(event);\n});\n"},2480:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return A}});var r=n(4111),o=n(7568),i=n(1438),a=n(2951),s=n(8029),l=n(460),c=n(655),u=n(5893),d=n(682),h=n(7294),f=n(9008),m=n.n(f),p=n(4087),g=n.n(p),w=n(6174);function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var S=100,b=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).canvas=h.createRef(),r.bufferLength=e.bufferLength,r.dataArray=e.dataArray,r.showThreshold=e.showThreshold,r.threshold=e.threshold,r.bpm=e.bpm,r.state={parentWidth:200},r}return(0,a.Z)(n,[{key:"componentDidMount",value:function(){this.setState({parentWidth:this.canvas.current.parentNode.offsetWidth})}},{key:"componentDidUpdate",value:function(e){this.bufferLength=e.bufferLength,this.dataArray=e.dataArray,this.threshold=e.threshold,this.bpm=e.bpm}},{key:"drawPcmGraph",value:function(){var e=this.canvas.current.getContext("2d"),t=this.canvas.current.parentNode.offsetWidth;if(e.clearRect(0,0,t,S),e.font="10px Courier New",e.fillStyle="white",!0===this.showThreshold?e.fillText("LowPass Signal",4,10):e.fillText("Original Signal",4,10),null!==this.threshold&&!0===this.showThreshold){var n=S*(1-this.threshold);e.beginPath(),e.moveTo(0,n),e.lineTo(t,n),e.lineWidth=1,e.strokeStyle="red",e.stroke(),e.font="bold 10px Courier New",e.fillStyle="red",e.fillText(this.threshold.toFixed(2),4,n-4);var r="BPM ".concat(this.bpm);e.fillText(r,t-e.measureText(r).width-4,n-4)}var o=t/this.bufferLength,i=!0,a=!1,s=void 0;try{for(var l,c=this.dataArray.entries()[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=v(l.value,2),d=u[0],h=u[1],f=S-S*(h/256)-1;e.fillStyle="white",e.fillRect(d*o,f,o,1)}}catch(m){a=!0,s=m}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}}},{key:"render",value:function(){return(0,u.jsx)("div",{className:"canvas-container bg-dark",children:(0,u.jsx)("canvas",{ref:this.canvas,height:S,width:this.state.parentWidth})})}}]),n}(h.Component),x=n(6308),A=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e)).originalSignal=h.createRef(),o.lowPassSignal=h.createRef(),o.scriptProcessorNode=null,o.realTimeBPMAnalyzer=null,o.originalSignalAnalyzer=null,o.lowPassSignalAnalyzer=null,o.originalSignalSource=null,o.lowPassSignalSource=null,o.timeout=null,o.state={start:!1,originalSignalDataArray:null,lowPassSignalDataArray:null,currentThreshold:0,currentBpm:0},o.toggleStart=o.toggleStart.bind((0,r.Z)(o)),o.onAudioProcess=o.onAudioProcess.bind((0,r.Z)(o)),o}return(0,a.Z)(n,[{key:"loadSound",value:function(e){var t=this,n=new window.XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",new Promise((function(e,r){n.addEventListener("load",(function(){t.audioContext.decodeAudioData(n.response,e,r)})),n.send()}))}},{key:"onEnded",value:function(){var e=this;return(0,o.Z)((function(){return(0,c.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.audioContext.suspend()];case 1:return t.sent(),e.setState({start:!1}),e.setState({currentThreshold:0}),e.setState({currentBpm:0}),[2]}}))}))()}},{key:"toggleStart",value:function(){var e=this;return(0,o.Z)((function(){return(0,c.__generator)(this,(function(t){switch(t.label){case 0:return e.audioContext=e.audioContext||x.kq(),e.setState((function(e){return e.start=!e.start,e})),[4,e.audioContext.resume()];case 1:return t.sent(),e.state.start?e.analyzeBpm():e.stopAnalyzer(),[2]}}))}))()}},{key:"onAudioProcess",value:function(e){var t=this;this.realTimeBPMAnalyzer.analyze(e),g()((function(){t.originalSignalAnalyzer.getByteTimeDomainData(t.state.originalSignalDataArray),t.lowPassSignalAnalyzer.getByteTimeDomainData(t.state.lowPassSignalDataArray),t.setState((function(e){return e})),t.originalSignal.current.drawPcmGraph(),t.lowPassSignal.current.drawPcmGraph()}))}},{key:"analyzeBpm",value:function(){var e=this;return(0,o.Z)((function(){var t;return(0,c.__generator)(this,(function(n){switch(n.label){case 0:return e.originalSignalSource=e.audioContext.createBufferSource(),e.lowPassSignalSource=e.audioContext.createBufferSource(),e.originalSignalAnalyzer=e.audioContext.createAnalyser(),e.lowPassSignalAnalyzer=e.audioContext.createAnalyser(),e.scriptProcessorNode=e.audioContext.createScriptProcessor(2048,1,1),e.originalSignalBufferLength=e.originalSignalAnalyzer.frequencyBinCount,e.lowPassSignalBufferLength=e.lowPassSignalAnalyzer.frequencyBinCount,e.setState({originalSignalDataArray:new Uint8Array(e.originalSignalBufferLength)}),e.setState({lowPassSignalDataArray:new Uint8Array(e.lowPassSignalBufferLength)}),e.originalSignalSource.connect(e.audioContext.destination),e.lowPassSignalSource.connect(e.audioContext.destination),e.filter=e.audioContext.createBiquadFilter(),e.filter.type="lowpass",e.lowPassSignalSource.connect(e.filter),e.filter.connect(e.lowPassSignalAnalyzer),e.originalSignalSource.connect(e.originalSignalAnalyzer),e.lowPassSignalAnalyzer.connect(e.scriptProcessorNode),e.scriptProcessorNode.connect(e.audioContext.destination),e.realTimeBPMAnalyzer=new w.RealTimeBPMAnalyzer({debug:!0,scriptNode:{bufferSize:2048},pushTime:2e3,pushCallback:function(t,n,r){t?console.warn(t):(e.setState({currentThreshold:r}),e.setState({currentBpm:n[0].tempo}))}}),e.scriptProcessorNode.addEventListener("audioprocess",e.onAudioProcess),[4,e.loadSound(x.WV)];case 1:return t=n.sent(),e.playSound(t),e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout((function(){e.onEnded()}),1e3*t.duration),[2]}}))}))()}},{key:"playSound",value:function(e){this.originalSignalSource.buffer=e,this.lowPassSignalSource.buffer=e,this.originalSignalSource.start(0),this.lowPassSignalSource.start(0)}},{key:"stopAnalyzer",value:function(){var e=this;return(0,o.Z)((function(){return(0,c.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.audioContext.suspend()];case 1:return t.sent(),e.scriptProcessorNode.removeEventListener("audioprocess",e.onAudioProcess),e.filter.disconnect(),e.originalSignalSource.disconnect(),e.lowPassSignalSource.disconnect(),e.scriptProcessorNode.disconnect(),e.originalSignalAnalyzer.disconnect(),e.lowPassSignalAnalyzer.disconnect(),e.setState({start:!1}),e.setState({currentThreshold:0}),e.setState({currentBpm:0}),e.realTimeBPMAnalyzer=null,[2]}}))}))()}},{key:"render",value:function(){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(m(),{children:[(0,u.jsx)("title",{children:"How it works ? | Realtime Bpm Analyzer"}),(0,u.jsx)("meta",{name:"description",content:"Experiment showing how the algorithm works"})]}),(0,u.jsxs)(d.Z,{className:"mt-3",children:[(0,u.jsx)("h1",{children:"How it works"}),(0,u.jsx)("p",{className:"lead",children:"This experiment will show how the analyzer is working to compute BPM (Beats Per Minute)."}),(0,u.jsx)("hr",{}),(0,u.jsx)("p",{className:"alert alert-info",children:"Press the button below to start the analyzer. You will be able to see how it's working during an analysis. This experiment shows the original signal and the lowpass ones."}),(0,u.jsx)("div",{className:"text-center mb-3",children:(0,u.jsxs)("div",{className:"btn-group",children:[(0,u.jsxs)("button",{type:"button",className:"btn btn-primary",disabled:this.state.start,onClick:this.toggleStart,children:[(0,u.jsx)("i",{className:"bi bi-play-circle"})," Start"]}),(0,u.jsxs)("button",{type:"button",className:"btn btn-dark",disabled:!this.state.start,onClick:this.toggleStart,children:[(0,u.jsx)("i",{className:"bi bi-stop-circle"})," Stop"]})]})})]}),(0,u.jsx)(b,{ref:this.originalSignal,bufferLength:this.originalSignalBufferLength,dataArray:this.state.originalSignalDataArray,className:"mb-3"}),(0,u.jsx)(d.Z,{children:(0,u.jsxs)("p",{className:"pt-3",children:["The ",(0,u.jsx)("strong",{children:"original signal"})," is actually ",(0,u.jsx)("a",{href:"https://en.wikipedia.org/wiki/Pulse-code_modulation",children:"PCM (Pulse-Code Modulation)"})," data. See also ",(0,u.jsx)("a",{href:"https://en.wikipedia.org/wiki/Digital_audio",children:"Digital Audio"})," for more information.",(0,u.jsx)("br",{})]})}),(0,u.jsx)(b,{ref:this.lowPassSignal,showThreshold:!0,bufferLength:this.lowPassSignalBufferLength,dataArray:this.state.lowPassSignalDataArray,threshold:this.state.currentThreshold,bpm:this.state.currentBpm,className:"mb-3"}),(0,u.jsxs)(d.Z,{children:[(0,u.jsx)("section",{className:"pt-3",children:(0,u.jsxs)("p",{children:["The ",(0,u.jsx)("strong",{children:"lowpass signal"})," is the same signal as the original one with a low pass filter applied on it.",(0,u.jsx)("br",{}),"To compute the ",(0,u.jsx)("strong",{children:"beats per minute"})," we are trying to find a minimum of 15 peaks at all thresholds (between 0.90 and 0.30) with a step of 0.05 (0.30, 0.35, 0.40 and so on...). We start from the lowest one to the highest because we have more chances (at the begining to find more occurences).",(0,u.jsx)("br",{}),"Once we have a ",(0,u.jsx)("i",{children:"valid"})," threshold, we keep looking for better ones (higher)."]})}),(0,u.jsxs)("p",{className:"alert alert-warning mb-5",children:["TODO: Illustrate the Joe Sullivan's diagram with all ",(0,u.jsx)("i",{children:"matches"})," at all available threshold"]})]})]})}}]),n}(h.Component)},7663:function(e){!function(){var t={229:function(e){var t,n,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"===typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var s,l=[],c=!1,u=-1;function d(){c&&s&&(c=!1,s.length?l=s.concat(l):u=-1,l.length&&h())}function h(){if(!c){var e=a(d);c=!0;for(var t=l.length;t;){for(s=l,l=[];++u<t;)s&&s[u].run();u=-1,t=l.length}s=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),1!==l.length||c||a(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={exports:{}},a=!0;try{t[e](i,i.exports,r),a=!1}finally{a&&delete n[e]}return i.exports}r.ab="//";var o=r(229);e.exports=o}()},75:function(e,t,n){var r=n(3454);(function(){var t,n,o,i,a,s;"undefined"!==typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!==typeof r&&null!==r&&r.hrtime?(e.exports=function(){return(t()-a)/1e6},n=r.hrtime,i=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),s=1e9*r.uptime(),a=i-s):Date.now?(e.exports=function(){return Date.now()-o},o=Date.now()):(e.exports=function(){return(new Date).getTime()-o},o=(new Date).getTime())}).call(this)},4087:function(e,t,n){for(var r=n(75),o="undefined"===typeof window?n.g:window,i=["moz","webkit"],a="AnimationFrame",s=o["request"+a],l=o["cancel"+a]||o["cancelRequest"+a],c=0;!s&&c<i.length;c++)s=o[i[c]+"Request"+a],l=o[i[c]+"Cancel"+a]||o[i[c]+"CancelRequest"+a];if(!s||!l){var u=0,d=0,h=[];s=function(e){if(0===h.length){var t=r(),n=Math.max(0,16.666666666666668-(t-u));u=n+t,setTimeout((function(){var e=h.slice(0);h.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(u)}catch(n){setTimeout((function(){throw n}),0)}}),Math.round(n))}return h.push({handle:++d,callback:e,cancelled:!1}),d},l=function(e){for(var t=0;t<h.length;t++)h[t].handle===e&&(h[t].cancelled=!0)}}e.exports=function(e){return s.call(o,e)},e.exports.cancel=function(){l.apply(o,arguments)},e.exports.polyfill=function(e){e||(e=o),e.requestAnimationFrame=s,e.cancelAnimationFrame=l}},6174:function(e,t,n){"use strict";n.d(t,{q:function(){return o}});var r=(e,t,n)=>new Promise(((r,o)=>{var i=e=>{try{s(n.next(e))}catch(t){o(t)}},a=e=>{try{s(n.throw(e))}catch(t){o(t)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,a);s((n=n.apply(e,t)).next())}));function o(e){return r(this,null,(function*(){const t=yield function(e,t){return r(this,null,(function*(){yield e.audioWorklet.addModule(`./${t}.js`);return new AudioWorkletNode(e,t)}))}(e,"realtime-bpm-processor");return yield e.resume(),t}))}},7568:function(e,t,n){"use strict";function r(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,l,"next",e)}function l(e){r(a,o,i,s,l,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return o}})}},function(e){e.O(0,[774,888,179],(function(){return t=6929,e(e.s=t);var t}));var t=e.O();_N_E=t}]);