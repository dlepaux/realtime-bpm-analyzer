(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[245],{3454:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"===typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(7663)},4654:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stream",function(){return n(7754)}])},2963:function(e,t,n){"use strict";var r=n(1438),a=n(2951),i=n(8029),o=n(460),s=n(5893),c=n(7294),l=100,u=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var a;return(0,r.Z)(this,n),(a=t.call(this,e)).canvas=c.createRef(),a.bufferLength=e.bufferLength,a.dataArray=e.dataArray,a.state={parentWidth:200},a}return(0,a.Z)(n,[{key:"componentDidMount",value:function(){this.setState({parentWidth:this.canvas.current.parentNode.offsetWidth})}},{key:"componentDidUpdate",value:function(e){var t=e.bufferLength,n=e.dataArray;this.bufferLength=t,this.dataArray=n}},{key:"drawFrequencyBarGraph",value:function(){console.log("drawFrequencyBarGraph");var e=this.canvas.current.getContext("2d"),t=this.canvas.current.parentNode.offsetWidth;e.clearRect(0,0,t,l),e.fillStyle="#212529",e.fillRect(0,0,t,l);for(var n,r=t/this.bufferLength*2.5,a=0,i=0;i<this.bufferLength;i++)n=this.dataArray[i]/2,e.fillStyle="rgba(100, 206, 170, ".concat((n/l).toFixed(2),")"),e.fillRect(a,l-n/2,r,n),a+=r+1}},{key:"render",value:function(){return(0,s.jsx)("div",{className:"canvas-container bg-dark",children:(0,s.jsx)("canvas",{ref:this.canvas,height:l,width:this.state.parentWidth})})}}]),n}(c.Component);t.Z=u},6308:function(e,t,n){"use strict";n.d(t,{Do:function(){return i},WV:function(){return a},kq:function(){return r},pM:function(){return c},vb:function(){return s},w9:function(){return o}});var r=function(){return new(window.AudioContext||window.mozAudioContext||window.webkitAudioContext)},a="".concat("/realtime-bpm-analyzer","/media/new_order-blue_monday.mp3"),i="npm install realtime-bpm-analyzer",o='<audio src="'.concat("/realtime-bpm-analyzer",'/media/new_order-blue_monday.mp3" id="music"></audio>'),s="// Create new instance of AudioContext\nconst audioContext = new AudioContext();\n// Set the source with the HTML Audio Node\nconst source = audioContext.createMediaElementSource(document.getElementById('music'));\n// Set the scriptProcessorNode to get PCM data in real time\nconst scriptProcessorNode = audioContext.createScriptProcessor(4096, 1, 1);\n// Connect everythings together\nscriptProcessorNode.connect(audioContext.destination);\nsource.connect(scriptProcessorNode);\nsource.connect(audioContext.destination);\n",c="import {RealTimeBPMAnalyzer} from 'realtime-bpm-analyzer';\n\nconst realTimeBPMAnalyzer = new RealTimeBPMAnalyzer({\n  scriptNode: {\n    bufferSize: 4096\n  },\n  pushTime: 2000,\n  pushCallback: (err, bpm) => {\n    console.log('bpm', bpm);\n  }\n});\n\n// Attach realTime function to audioprocess event.inputBuffer (AudioBuffer)\nscriptProcessorNode.addEventListener('audioprocess', event => {\n  realTimeBPMAnalyzer.analyze(event);\n});\n"},7754:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var r=n(4111),a=n(7568),i=n(1438),o=n(2951),s=n(8029),c=n(460),l=n(655),u=n(5893),d=n(682),m=n(7294),h=n(9008),f=n.n(h),p=n(4087),y=n.n(p),v=n(6174),b=n(2963),x=n(6308),g=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var a;return(0,i.Z)(this,n),(a=t.call(this,e)).analyzer=null,a.bufferLength=null,a.audioContext=null,a.source=null,a.scriptProcessorNode=null,a.realTimeBPMAnalyzer=null,a.state={isAnalyzing:!1,dataArray:null,defaultStreamEndpoint:"https://ssl1.viastreaming.net:7005/;listen.mp3",computeBPMDelay:5e3,stabilizationTime:1e4,pushTime:1e3,currentTempo:0},a.music=m.createRef(null),a.graph=m.createRef(null),a.analyzeBpm=a.analyzeBpm.bind((0,r.Z)(a)),a.onAudioProcess=a.onAudioProcess.bind((0,r.Z)(a)),a.onChangeStreamEndpoint=a.onChangeStreamEndpoint.bind((0,r.Z)(a)),a.onChangePushTime=a.onChangePushTime.bind((0,r.Z)(a)),a.onChangeComputeBPMDelay=a.onChangeComputeBPMDelay.bind((0,r.Z)(a)),a.onChangeStabilizationTime=a.onChangeStabilizationTime.bind((0,r.Z)(a)),a}return(0,o.Z)(n,[{key:"analyzeBpm",value:function(){var e=this;return(0,a.Z)((function(){return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return e.state.isAnalyzing?[2]:(e.audioContext=e.audioContext||x.kq(),[4,e.audioContext.resume()]);case 1:return t.sent(),e.setState({isAnalyzing:!0}),e.analyzer=e.audioContext.createAnalyser(),e.analyzer.fftSize=1024,e.bufferLength=e.analyzer.frequencyBinCount,e.setState({dataArray:new Uint8Array(e.bufferLength)}),e.source=e.source||e.audioContext.createMediaElementSource(e.music.current),e.scriptProcessorNode=e.audioContext.createScriptProcessor(4096,1,1),e.source.connect(e.analyzer),e.scriptProcessorNode.connect(e.audioContext.destination),e.source.connect(e.scriptProcessorNode),e.source.connect(e.audioContext.destination),e.realTimeBPMAnalyzer=new v.RealTimeBPMAnalyzer({debug:!0,scriptNode:{bufferSize:4096},computeBPMDelay:e.state.computeBPMDelay,stabilizationTime:e.state.stabilizationTime,continuousAnalysis:!0,pushTime:e.state.pushTime,pushCallback:function(t,n){t?console.warn(t):"undefined"!==typeof n[0]&&e.setState({currentTempo:n[0].tempo})}}),e.scriptProcessorNode.addEventListener("audioprocess",e.onAudioProcess),e.music.current.play(),[2]}}))}))()}},{key:"onAudioProcess",value:function(e){var t=this;this.realTimeBPMAnalyzer.analyze(e),y()((function(){t.analyzer.getByteFrequencyData(t.state.dataArray),t.setState((function(e){return e})),t.graph.current.drawFrequencyBarGraph()}))}},{key:"onChangeStreamEndpoint",value:function(e){this.setState({defaultStreamEndpoint:e.target.value}),this.restartAnalyzer()}},{key:"onChangePushTime",value:function(e){this.setState({pushTime:e.target.value}),this.restartAnalyzer()}},{key:"onChangeComputeBPMDelay",value:function(e){this.setState({computeBPMDelay:e.target.value}),this.restartAnalyzer()}},{key:"onChangeStabilizationTime",value:function(e){this.setState({stabilizationTime:e.target.value}),this.restartAnalyzer()}},{key:"restartAnalyzer",value:function(){var e=this;return(0,a.Z)((function(){return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return e.state.isAnalyzing?[4,e.audioContext.suspend()]:[2];case 1:return t.sent(),e.source.disconnect(),e.scriptProcessorNode.disconnect(),e.analyzer.disconnect(),e.setState({isAnalyzing:!1}),e.scriptProcessorNode.removeEventListener("audioprocess",e.onAudioProcess),e.realTimeBPMAnalyzer=null,e.setState({currentTempo:0}),e.analyzeBpm(),[2]}}))}))()}},{key:"render",value:function(){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(f(),{children:[(0,u.jsx)("title",{children:"Stream usage example | Realtime Bpm Analyzer"}),(0,u.jsx)("meta",{name:"description",content:"Example using the Realtime BPM Analyzer on a stream. This example allows you to test any stream and configure the analyzer."})]}),(0,u.jsxs)(d.Z,{className:"pt-3",children:[(0,u.jsx)("h1",{children:"Stream"}),(0,u.jsxs)("div",{className:"lead",children:["Exemple of the usage of the analyzer with a ",(0,u.jsx)("code",{children:"Stream"}),"."]}),(0,u.jsx)("hr",{}),(0,u.jsx)("audio",{ref:this.music,controls:!0,src:this.state.defaultStreamEndpoint,crossOrigin:"anonymous",className:"w-100"}),(0,u.jsx)("div",{className:"mt-2",children:(0,u.jsx)("p",{className:"text-center",children:(0,u.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",disabled:this.state.isAnalyzing,onClick:this.analyzeBpm,children:[(0,u.jsx)("i",{className:"bi bi-play-circle"})," Play and Analyze BPM"]})})})]}),(0,u.jsx)(b.Z,{ref:this.graph,bufferLength:this.bufferLength,dataArray:this.state.dataArray}),(0,u.jsx)(d.Z,{className:"pt-3",children:(0,u.jsxs)("div",{className:"row mt-3 mb-3",children:[(0,u.jsx)("div",{className:"col-md-6 col-sm-12",children:(0,u.jsxs)("form",{children:[(0,u.jsxs)("div",{className:"mb-3",children:[(0,u.jsx)("label",{htmlFor:"streamEndpoint",className:"form-label",children:"Stream Endpoint"}),(0,u.jsx)("input",{type:"text",className:"form-control",id:"streamEndpoint","aria-describedby":"streamEndpointDescription",value:this.state.defaultStreamEndpoint,onChange:this.onChangeStreamEndpoint}),(0,u.jsxs)("div",{id:"streamEndpointDescription",className:"form-text",children:["Stream endpoint analyzed by the library. The default value is a stream from ",(0,u.jsx)("a",{href:"https://ibizasonica.com/",children:"IbizaSonica Radio"})," \u2665."]})]}),(0,u.jsxs)("div",{className:"mb-3",children:[(0,u.jsxs)("label",{htmlFor:"pushTime",className:"form-label",children:["Push Time (",this.state.pushTime," milliseconds)"]}),(0,u.jsx)("input",{type:"range",className:"form-range",min:"100",max:"5000",step:"100",id:"pushTime","aria-describedby":"pushTimeDescription",value:this.state.pushTime,onChange:this.onChangePushTime}),(0,u.jsxs)("div",{id:"pushTimeDescription",className:"form-text",children:["BPM will be computed at each tick of ",this.state.pushTime," milliseconds."]})]}),(0,u.jsxs)("div",{className:"mb-3",children:[(0,u.jsxs)("label",{htmlFor:"computeBPMDelay",className:"form-label",children:["Compute BPM Delay (",this.state.computeBPMDelay," milliseconds)"]}),(0,u.jsx)("input",{type:"range",className:"form-range",min:"1000",max:"20000",step:"1000",id:"computeBPMDelay","aria-describedby":"computeBPMDelayDescription",value:this.state.computeBPMDelay,onChange:this.onChangeComputeBPMDelay}),(0,u.jsx)("div",{id:"computeBPMDelayDescription",className:"form-text",children:"BPM computation will start after this delay."})]}),(0,u.jsxs)("div",{className:"mb-3",children:[(0,u.jsxs)("label",{htmlFor:"stabilizationTime",className:"form-label",children:["Stabilization Time (",this.state.stabilizationTime," milliseconds)"]}),(0,u.jsx)("input",{type:"range",className:"form-range",min:"10000",max:"60000",step:"1000",id:"stabilizationTime","aria-describedby":"stabilizationTimeDescription",value:this.state.stabilizationTime,onChange:this.onChangeStabilizationTime}),(0,u.jsx)("div",{id:"stabilizationTimeDescription",className:"form-text",children:"BPM will be considered as stable after this time."})]})]})}),(0,u.jsx)("div",{className:"col-md-6 col-sm-12",children:(0,u.jsx)("div",{className:"d-flex h-100 align-items-start justify-content-center",children:(0,u.jsx)("div",{className:"card bg-dark mb-3",children:(0,u.jsx)("div",{className:"card-body text-center",children:(0,u.jsxs)("span",{className:"display-6",children:["Current BPM ",(0,u.jsx)("span",{children:this.state.currentTempo}),(0,u.jsx)("br",{}),(0,u.jsx)("i",{className:"bi bi-soundwave"})]})})})})})]})})]})}}]),n}(m.Component)},7663:function(e){!function(){var t={229:function(e){var t,n,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"===typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var s,c=[],l=!1,u=-1;function d(){l&&s&&(l=!1,s.length?c=s.concat(c):u=-1,c.length&&m())}function m(){if(!l){var e=o(d);l=!0;for(var t=c.length;t;){for(s=c,c=[];++u<t;)s&&s[u].run();u=-1,t=c.length}s=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||l||o(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}},o=!0;try{t[e](i,i.exports,r),o=!1}finally{o&&delete n[e]}return i.exports}r.ab="//";var a=r(229);e.exports=a}()},75:function(e,t,n){var r=n(3454);(function(){var t,n,a,i,o,s;"undefined"!==typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!==typeof r&&null!==r&&r.hrtime?(e.exports=function(){return(t()-o)/1e6},n=r.hrtime,i=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),s=1e9*r.uptime(),o=i-s):Date.now?(e.exports=function(){return Date.now()-a},a=Date.now()):(e.exports=function(){return(new Date).getTime()-a},a=(new Date).getTime())}).call(this)},4087:function(e,t,n){for(var r=n(75),a="undefined"===typeof window?n.g:window,i=["moz","webkit"],o="AnimationFrame",s=a["request"+o],c=a["cancel"+o]||a["cancelRequest"+o],l=0;!s&&l<i.length;l++)s=a[i[l]+"Request"+o],c=a[i[l]+"Cancel"+o]||a[i[l]+"CancelRequest"+o];if(!s||!c){var u=0,d=0,m=[];s=function(e){if(0===m.length){var t=r(),n=Math.max(0,16.666666666666668-(t-u));u=n+t,setTimeout((function(){var e=m.slice(0);m.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(u)}catch(n){setTimeout((function(){throw n}),0)}}),Math.round(n))}return m.push({handle:++d,callback:e,cancelled:!1}),d},c=function(e){for(var t=0;t<m.length;t++)m[t].handle===e&&(m[t].cancelled=!0)}}e.exports=function(e){return s.call(a,e)},e.exports.cancel=function(){c.apply(a,arguments)},e.exports.polyfill=function(e){e||(e=a),e.requestAnimationFrame=s,e.cancelAnimationFrame=c}},6174:function(e,t,n){"use strict";n.d(t,{q:function(){return a}});var r=(e,t,n)=>new Promise(((r,a)=>{var i=e=>{try{s(n.next(e))}catch(t){a(t)}},o=e=>{try{s(n.throw(e))}catch(t){a(t)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);s((n=n.apply(e,t)).next())}));function a(e){return r(this,null,(function*(){const t=yield function(e,t){return r(this,null,(function*(){yield e.audioWorklet.addModule(`./${t}.js`);return new AudioWorkletNode(e,t)}))}(e,"realtime-bpm-processor");return yield e.resume(),t}))}},7568:function(e,t,n){"use strict";function r(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var o=e.apply(t,n);function s(e){r(o,a,i,s,c,"next",e)}function c(e){r(o,a,i,s,c,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return a}})}},function(e){e.O(0,[774,888,179],(function(){return t=4654,e(e.s=t);var t}));var t=e.O();_N_E=t}]);