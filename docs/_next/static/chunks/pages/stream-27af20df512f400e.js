(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[245],{4654:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stream",function(){return a(7754)}])},7754:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return z}});var n=a(4111),s=a(7568),i=a(1438),r=a(2951),o=a(8029),l=a(460),c=a(655),d=a(5893),u=a(682),m=a(7294),h=a(9008),p=a.n(h),y=a(4087),f=a.n(y),b=a(6174),x=a(2963),g=a(6308),z=function(e){(0,o.Z)(a,e);var t=(0,l.Z)(a);function a(e){var s;return(0,i.Z)(this,a),(s=t.call(this,e)).analyzer=null,s.bufferLength=null,s.audioContext=null,s.source=null,s.scriptProcessorNode=null,s.realtimeAnalyzerNode=null,s.state={isAnalyzing:!1,dataArray:null,defaultStreamEndpoint:"https://ssl1.viastreaming.net:7005/;listen.mp3",computeBPMDelay:5e3,stabilizationTime:1e4,currentTempo:0},s.music=m.createRef(null),s.graph=m.createRef(null),s.analyzeBpm=s.analyzeBpm.bind((0,n.Z)(s)),s.onAudioProcess=s.onAudioProcess.bind((0,n.Z)(s)),s.onChangeStreamEndpoint=s.onChangeStreamEndpoint.bind((0,n.Z)(s)),s.onChangeComputeBPMDelay=s.onChangeComputeBPMDelay.bind((0,n.Z)(s)),s.onChangeStabilizationTime=s.onChangeStabilizationTime.bind((0,n.Z)(s)),s}return(0,r.Z)(a,[{key:"analyzeBpm",value:function(){var e=this;return(0,s.Z)((function(){return(0,c.__generator)(this,(function(t){switch(t.label){case 0:return e.state.isAnalyzing?[2]:(e.audioContext=e.audioContext||g.kq(),[4,e.audioContext.resume()]);case 1:return t.sent(),[4,(0,b.q)(e.audioContext).catch((function(e){return console.log(e)}))];case 2:return e.realtimeAnalyzerNode=t.sent(),e.filter=e.audioContext.createBiquadFilter(),e.filter.type="lowpass",e.setState({isAnalyzing:!0}),e.analyzer=e.audioContext.createAnalyser(),e.analyzer.fftSize=1024,e.bufferLength=e.analyzer.frequencyBinCount,e.setState({dataArray:new Uint8Array(e.bufferLength)}),e.source=e.source||e.audioContext.createMediaElementSource(e.music.current),e.scriptProcessorNode=e.audioContext.createScriptProcessor(4096,1,1),e.source.connect(e.filter).connect(e.realtimeAnalyzerNode),e.source.connect(e.analyzer),e.scriptProcessorNode.connect(e.audioContext.destination),e.source.connect(e.scriptProcessorNode),e.source.connect(e.audioContext.destination),e.realtimeAnalyzerNode.port.addEventListener("message",e.onMessage.bind(e)),e.realtimeAnalyzerNode.port.start(),e.scriptProcessorNode.addEventListener("audioprocess",e.onAudioProcess),e.music.current.play(),[2]}}))}))()}},{key:"onMessage",value:function(e){"BPM"===e.data.message&&e.data.result.bpm.length>0&&this.setState({currentTempo:e.data.result.bpm[0].tempo})}},{key:"onAudioProcess",value:function(){var e=this;f()((function(){e.analyzer.getByteFrequencyData(e.state.dataArray),e.setState((function(e){return e})),e.graph.current.drawFrequencyBarGraph()}))}},{key:"onChangeStreamEndpoint",value:function(e){this.setState({defaultStreamEndpoint:e.target.value}),this.restartAnalyzer()}},{key:"onChangeComputeBPMDelay",value:function(e){this.setState({computeBPMDelay:e.target.value}),this.restartAnalyzer()}},{key:"onChangeStabilizationTime",value:function(e){this.setState({stabilizationTime:e.target.value}),this.restartAnalyzer()}},{key:"restartAnalyzer",value:function(){var e=this;return(0,s.Z)((function(){return(0,c.__generator)(this,(function(t){switch(t.label){case 0:return e.state.isAnalyzing?[4,e.audioContext.suspend()]:[2];case 1:return t.sent(),e.source.disconnect(),e.scriptProcessorNode.disconnect(),e.realtimeAnalyzerNode.disconnect(),e.analyzer.disconnect(),e.setState({isAnalyzing:!1}),e.scriptProcessorNode.removeEventListener("audioprocess",e.onAudioProcess),e.setState({currentTempo:0}),e.analyzeBpm(),[2]}}))}))()}},{key:"render",value:function(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(p(),{children:[(0,d.jsx)("title",{children:"Stream usage example | Realtime Bpm Analyzer"}),(0,d.jsx)("meta",{name:"description",content:"Example using the Realtime BPM Analyzer on a stream. This example allows you to test any stream and configure the analyzer."})]}),(0,d.jsxs)(u.Z,{className:"pt-3",children:[(0,d.jsx)("h1",{children:"Stream"}),(0,d.jsxs)("div",{className:"lead",children:["Exemple of the usage of the analyzer with a ",(0,d.jsx)("code",{children:"Stream"}),"."]}),(0,d.jsx)("hr",{}),(0,d.jsx)("audio",{ref:this.music,controls:!0,src:this.state.defaultStreamEndpoint,crossOrigin:"anonymous",className:"w-100"}),(0,d.jsx)("div",{className:"mt-2",children:(0,d.jsx)("p",{className:"text-center",children:(0,d.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",disabled:this.state.isAnalyzing,onClick:this.analyzeBpm,children:[(0,d.jsx)("i",{className:"bi bi-play-circle"})," Play and Analyze BPM"]})})})]}),(0,d.jsx)(x.Z,{ref:this.graph,bufferLength:this.bufferLength,dataArray:this.state.dataArray}),(0,d.jsx)(u.Z,{className:"pt-3",children:(0,d.jsxs)("div",{className:"row mt-3 mb-3",children:[(0,d.jsx)("div",{className:"col-md-6 col-sm-12",children:(0,d.jsxs)("form",{children:[(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsx)("label",{htmlFor:"streamEndpoint",className:"form-label",children:"Stream Endpoint"}),(0,d.jsx)("input",{type:"text",className:"form-control",id:"streamEndpoint","aria-describedby":"streamEndpointDescription",value:this.state.defaultStreamEndpoint,onChange:this.onChangeStreamEndpoint}),(0,d.jsxs)("div",{id:"streamEndpointDescription",className:"form-text",children:["Stream endpoint analyzed by the library. The default value is a stream from ",(0,d.jsx)("a",{href:"https://ibizasonica.com/",children:"IbizaSonica Radio"})," \u2665."]})]}),(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsxs)("label",{htmlFor:"computeBPMDelay",className:"form-label",children:["Compute BPM Delay (",this.state.computeBPMDelay," milliseconds)"]}),(0,d.jsx)("input",{type:"range",className:"form-range",min:"1000",max:"20000",step:"1000",id:"computeBPMDelay","aria-describedby":"computeBPMDelayDescription",value:this.state.computeBPMDelay,onChange:this.onChangeComputeBPMDelay}),(0,d.jsx)("div",{id:"computeBPMDelayDescription",className:"form-text",children:"BPM computation will start after this delay."})]}),(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsxs)("label",{htmlFor:"stabilizationTime",className:"form-label",children:["Stabilization Time (",this.state.stabilizationTime," milliseconds)"]}),(0,d.jsx)("input",{type:"range",className:"form-range",min:"10000",max:"60000",step:"1000",id:"stabilizationTime","aria-describedby":"stabilizationTimeDescription",value:this.state.stabilizationTime,onChange:this.onChangeStabilizationTime}),(0,d.jsx)("div",{id:"stabilizationTimeDescription",className:"form-text",children:"BPM will be considered as stable after this time."})]})]})}),(0,d.jsx)("div",{className:"col-md-6 col-sm-12",children:(0,d.jsx)("div",{className:"d-flex h-100 align-items-start justify-content-center",children:(0,d.jsx)("div",{className:"card bg-dark mb-3",children:(0,d.jsx)("div",{className:"card-body text-center",children:(0,d.jsxs)("span",{className:"display-6",children:["Current BPM ",(0,d.jsx)("span",{children:this.state.currentTempo}),(0,d.jsx)("br",{}),(0,d.jsx)("i",{className:"bi bi-soundwave"})]})})})})})]})})]})}}]),a}(m.Component)}},function(e){e.O(0,[521,774,888,179],(function(){return t=4654,e(e.s=t);var t}));var t=e.O();_N_E=t}]);