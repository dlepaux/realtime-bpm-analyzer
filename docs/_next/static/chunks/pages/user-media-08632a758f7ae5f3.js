(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[220],{337:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/user-media",function(){return n(1348)}])},1348:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var a=n(4111),r=n(7568),s=n(1438),o=n(2951),i=n(8029),c=n(460),l=n(655),d=n(5893),u=n(682),h=n(6518),m=n(7294),p=n(9008),x=n.n(p),f=n(4087),y=n.n(f),b=n(6174),g=n(2963),C=n(6308),j=function(e){(0,i.Z)(n,e);var t=(0,c.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e)).music=m.createRef(null),r.graph=m.createRef(null),r.analyzer=null,r.bufferLength=null,r.audioContext=null,r.mediaStreamSource=null,r.scriptProcessorNode=null,r.realtimeAnalyzerNode=null,r.stream=null,r.filter=null,r.state={open:!1,isRecording:!1,dataArray:null,firstCandidateTempo:0,firstCandidateCount:0,secondCandidateTempo:0,secondCandidateCount:0},r.onAudioProcess=r.onAudioProcess.bind((0,a.Z)(r)),r.stopRecording=r.stopRecording.bind((0,a.Z)(r)),r.listenMicrophone=r.listenMicrophone.bind((0,a.Z)(r)),r.toggleCollapse=r.toggleCollapse.bind((0,a.Z)(r)),r}return(0,o.Z)(n,[{key:"listenMicrophone",value:function(){var e=this;return(0,r.Z)((function(){return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return e.audioContext=e.audioContext||C.kq(),[4,e.audioContext.resume()];case 1:return t.sent(),e.setState({isRecording:!0}),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){e.stream=t,e.onStream(t)})).catch((function(e){console.error(e)})),[2]}}))}))()}},{key:"stopRecording",value:function(){var e=this;return(0,r.Z)((function(){var t,n,a,r,s,o;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return e.setState({isRecording:!1}),e.audioContext?[4,e.audioContext.suspend()]:[3,2];case 1:i.sent(),i.label=2;case 2:if(e.scriptProcessorNode&&e.scriptProcessorNode.removeEventListener("audioprocess",e.onAudioProcess),e.realTimeBPMAnalyzer=null,!e.stream)return[2];t=!0,n=!1,a=void 0;try{for(r=e.stream.getTracks()[Symbol.iterator]();!(t=(s=r.next()).done);t=!0)"live"===(o=s.value).readyState&&o.stop()}catch(c){n=!0,a=c}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}return[2]}}))}))()}},{key:"onStream",value:function(e){var t=this;return(0,r.Z)((function(){return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.audioContext.resume()];case 1:return n.sent(),[4,(0,b.q)(t.audioContext).catch((function(e){return console.log(e)}))];case 2:return t.realtimeAnalyzerNode=n.sent(),t.filter=t.audioContext.createBiquadFilter(),t.filter.type="lowpass",t.analyzer=t.audioContext.createAnalyser(),t.analyzer.fftSize=1024,t.bufferLength=t.analyzer.frequencyBinCount,t.setState({dataArray:new Uint8Array(t.bufferLength)}),t.mediaStreamSource=t.audioContext.createMediaStreamSource(e),t.scriptProcessorNode=t.audioContext.createScriptProcessor(4096,1,1),t.mediaStreamSource.connect(t.filter).connect(t.realtimeAnalyzerNode),t.mediaStreamSource.connect(t.analyzer),t.mediaStreamSource.connect(t.scriptProcessorNode),t.scriptProcessorNode.connect(t.audioContext.destination),t.realtimeAnalyzerNode.port.addEventListener("message",t.onMessage.bind(t)),t.realtimeAnalyzerNode.port.start(),t.scriptProcessorNode.addEventListener("audioprocess",t.onAudioProcess.bind(t)),[2]}}))}))()}},{key:"onMessage",value:function(e){console.log(e),"BPM"===e.data.message&&e.data.result.bpm.length>1&&(this.setState({firstCandidateTempo:e.data.result.bpm[0].tempo}),this.setState({firstCandidateCount:e.data.result.bpm[0].count}),this.setState({secondCandidateTempo:e.data.result.bpm[1].tempo}),this.setState({secondCandidateCount:e.data.result.bpm[1].count}))}},{key:"onAudioProcess",value:function(){var e=this;y()((function(){e.analyzer.getByteFrequencyData(e.state.dataArray),e.setState((function(e){return e})),e.graph.current.drawFrequencyBarGraph()}))}},{key:"toggleCollapse",value:function(){this.setState((function(e){return e.open=!e.open,e}))}},{key:"render",value:function(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(x(),{children:[(0,d.jsx)("title",{children:"Microphone usage example | Realtime Bpm Analyzer"}),(0,d.jsx)("meta",{name:"description",content:"Example using the Microphone (UserMedia) of the user. Detect the BPM arround you !"})]}),(0,d.jsxs)(u.Z,{className:"pt-3",children:[(0,d.jsx)("h1",{children:"User Media"}),(0,d.jsxs)("div",{className:"lead",children:["Exemple of the usage of the analyzer with a ",(0,d.jsx)("code",{children:"MediaStreamSource"})," (microphone)."]}),(0,d.jsx)("hr",{}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",style:this.state.isRecording?{}:{display:"none"},onClick:this.stopRecording,children:[(0,d.jsx)("i",{className:"bi bi-record-fill"})," Stop Recording"]}),(0,d.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",style:this.state.isRecording?{display:"none"}:{},onClick:this.listenMicrophone,children:[(0,d.jsx)("i",{className:"bi bi-soundwave"})," Detect BPM with your Microphone"]}),(0,d.jsx)("br",{}),(0,d.jsx)("small",{className:"text-muted","aria-expanded":this.state.open,"aria-controls":"help",onClick:this.toggleCollapse,children:"More info"})]}),(0,d.jsx)(h.Z,{in:this.state.open,children:(0,d.jsx)("div",{id:"help",children:(0,d.jsxs)("div",{className:"alert alert-dark",children:["Start the experiment by clicking the button above, then you may have an alert to allow access to your microphone.",(0,d.jsx)("br",{}),"If you do not have the alert, it means either that you already gave access to it or you have an issue with your material.",(0,d.jsx)("br",{}),(0,d.jsx)("hr",{}),"You can emulate the behaviour of a microphone by looping back your output as an input to your machine to detect BPM of what you're listening right now.",(0,d.jsxs)("ul",{children:[(0,d.jsxs)("li",{children:["On Windows envrionment Enable the ",(0,d.jsx)("strong",{children:"stereoMix"})," in your audio params to emulate the behaviour of a micro."]}),(0,d.jsxs)("li",{children:["On MacOS you can use ",(0,d.jsx)("em",{children:"LoopBack"})," to put the output of Chrome on your micro input."]})]})]})})})]}),(0,d.jsx)(g.Z,{ref:this.graph,bufferLength:this.bufferLength,dataArray:this.state.dataArray}),(0,d.jsx)(u.Z,{children:(0,d.jsx)("div",{className:"d-flex justify-content-center pt-5 pb-5",children:(0,d.jsx)("div",{className:"card bg-dark col-lg-6 col-md-8 col-sm-10",children:(0,d.jsxs)("div",{className:"card-body text-center",children:[(0,d.jsxs)("span",{className:"display-6",children:[(0,d.jsxs)("span",{children:["First Candidate BPM ",this.state.firstCandidateTempo]}),(0,d.jsx)("br",{}),(0,d.jsxs)("span",{className:"text-muted",children:["Second Candidate BPM ",this.state.secondCandidateTempo]}),(0,d.jsx)("br",{}),(0,d.jsx)("i",{className:"bi bi-soundwave"}),(0,d.jsx)("br",{}),(0,d.jsxs)("span",{className:"text-muted",children:["Current Threshold ",this.state.formattedCurrentThreshold]})]}),(0,d.jsx)("br",{}),(0,d.jsx)("small",{className:"text-muted",children:"High threshold (between 0.30 and 0.90) means stable BPM."}),(0,d.jsx)("br",{}),(0,d.jsxs)("small",{className:"text-muted",children:["First Candidate Count ",this.state.firstCandidateCount]}),(0,d.jsx)("br",{}),(0,d.jsxs)("small",{className:"text-muted",children:["Second Candidate Count ",this.state.secondCandidateCount]})]})})})})]})}}]),n}(m.Component)}},function(e){e.O(0,[521,774,888,179],(function(){return t=337,e(e.s=t);var t}));var t=e.O();_N_E=t}]);