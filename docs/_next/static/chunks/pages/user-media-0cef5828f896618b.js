(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[220],{3454:function(e,t,n){"use strict";var r,o;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"===typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(7663)},337:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/user-media",function(){return n(1348)}])},2963:function(e,t,n){"use strict";var r=n(1438),o=n(2951),a=n(8029),i=n(460),s=n(5893),c=n(7294),u=100,l=function(e){(0,a.Z)(n,e);var t=(0,i.Z)(n);function n(e){var o;return(0,r.Z)(this,n),(o=t.call(this,e)).canvas=c.createRef(),o.bufferLength=e.bufferLength,o.dataArray=e.dataArray,o.state={parentWidth:200},o}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){this.setState({parentWidth:this.canvas.current.parentNode.offsetWidth})}},{key:"componentDidUpdate",value:function(e){var t=e.bufferLength,n=e.dataArray;this.bufferLength=t,this.dataArray=n}},{key:"drawFrequencyBarGraph",value:function(){console.log("drawFrequencyBarGraph");var e=this.canvas.current.getContext("2d"),t=this.canvas.current.parentNode.offsetWidth;e.clearRect(0,0,t,u),e.fillStyle="#212529",e.fillRect(0,0,t,u);for(var n,r=t/this.bufferLength*2.5,o=0,a=0;a<this.bufferLength;a++)n=this.dataArray[a]/2,e.fillStyle="rgba(100, 206, 170, ".concat((n/u).toFixed(2),")"),e.fillRect(o,u-n/2,r,n),o+=r+1}},{key:"render",value:function(){return(0,s.jsx)("div",{className:"canvas-container bg-dark",children:(0,s.jsx)("canvas",{ref:this.canvas,height:u,width:this.state.parentWidth})})}}]),n}(c.Component);t.Z=l},6308:function(e,t,n){"use strict";n.d(t,{Do:function(){return a},WV:function(){return o},kq:function(){return r},pM:function(){return c},vb:function(){return s},w9:function(){return i}});var r=function(){return new(window.AudioContext||window.mozAudioContext||window.webkitAudioContext)},o="".concat("/realtime-bpm-analyzer","/media/new_order-blue_monday.mp3"),a="npm install realtime-bpm-analyzer",i='<audio src="'.concat("/realtime-bpm-analyzer",'/media/new_order-blue_monday.mp3" id="music"></audio>'),s="// Create new instance of AudioContext\nconst audioContext = new AudioContext();\n// Set the source with the HTML Audio Node\nconst source = audioContext.createMediaElementSource(document.getElementById('music'));\n// Set the scriptProcessorNode to get PCM data in real time\nconst scriptProcessorNode = audioContext.createScriptProcessor(4096, 1, 1);\n// Connect everythings together\nscriptProcessorNode.connect(audioContext.destination);\nsource.connect(scriptProcessorNode);\nsource.connect(audioContext.destination);\n",c="import {RealTimeBPMAnalyzer} from 'realtime-bpm-analyzer';\n\nconst realTimeBPMAnalyzer = new RealTimeBPMAnalyzer({\n  scriptNode: {\n    bufferSize: 4096\n  },\n  pushTime: 2000,\n  pushCallback: (err, bpm) => {\n    console.log('bpm', bpm);\n  }\n});\n\n// Attach realTime function to audioprocess event.inputBuffer (AudioBuffer)\nscriptProcessorNode.addEventListener('audioprocess', event => {\n  realTimeBPMAnalyzer.analyze(event);\n});\n"},1348:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var r=n(4111),o=n(7568),a=n(1438),i=n(2951),s=n(8029),c=n(460),u=n(655),l=n(5893),d=n(682),h=n(6518),f=n(7294),m=n(9008),p=n.n(m),y=n(4087),v=n.n(y),x=n(6174),b=n(2963),g=n(6308),w=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var o;return(0,a.Z)(this,n),(o=t.call(this,e)).music=f.createRef(null),o.graph=f.createRef(null),o.analyzer=null,o.bufferLength=null,o.audioContext=null,o.mediaStreamSource=null,o.scriptProcessorNode=null,o.realtimeAnalyzerNode=null,o.stream=null,o.filter=null,o.state={open:!1,isRecording:!1,dataArray:null,firstCandidateTempo:0,firstCandidateCount:0,secondCandidateTempo:0,secondCandidateCount:0},o.onAudioProcess=o.onAudioProcess.bind((0,r.Z)(o)),o.stopRecording=o.stopRecording.bind((0,r.Z)(o)),o.listenMicrophone=o.listenMicrophone.bind((0,r.Z)(o)),o.toggleCollapse=o.toggleCollapse.bind((0,r.Z)(o)),o}return(0,i.Z)(n,[{key:"listenMicrophone",value:function(){var e=this;return(0,o.Z)((function(){return(0,u.__generator)(this,(function(t){switch(t.label){case 0:return e.audioContext=e.audioContext||g.kq(),[4,e.audioContext.resume()];case 1:return t.sent(),e.setState({isRecording:!0}),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){e.stream=t,e.onStream(t)})).catch((function(e){console.error(e)})),[2]}}))}))()}},{key:"stopRecording",value:function(){var e=this;return(0,o.Z)((function(){var t,n,r,o,a,i;return(0,u.__generator)(this,(function(s){switch(s.label){case 0:return e.setState({isRecording:!1}),e.audioContext?[4,e.audioContext.suspend()]:[3,2];case 1:s.sent(),s.label=2;case 2:if(e.scriptProcessorNode&&e.scriptProcessorNode.removeEventListener("audioprocess",e.onAudioProcess),e.realTimeBPMAnalyzer=null,!e.stream)return[2];t=!0,n=!1,r=void 0;try{for(o=e.stream.getTracks()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)"live"===(i=a.value).readyState&&i.stop()}catch(c){n=!0,r=c}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return[2]}}))}))()}},{key:"onStream",value:function(e){var t=this;return(0,o.Z)((function(){return(0,u.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.audioContext.resume()];case 1:return n.sent(),[4,(0,x.q)(t.audioContext).catch((function(e){return console.log(e)}))];case 2:return t.realtimeAnalyzerNode=n.sent(),t.filter=t.audioContext.createBiquadFilter(),t.filter.type="lowpass",t.analyzer=t.audioContext.createAnalyser(),t.analyzer.fftSize=1024,t.bufferLength=t.analyzer.frequencyBinCount,t.setState({dataArray:new Uint8Array(t.bufferLength)}),t.mediaStreamSource=t.audioContext.createMediaStreamSource(e),t.scriptProcessorNode=t.audioContext.createScriptProcessor(4096,1,1),t.mediaStreamSource.connect(t.filter).connect(t.realtimeAnalyzerNode),t.mediaStreamSource.connect(t.analyzer),t.mediaStreamSource.connect(t.scriptProcessorNode),t.scriptProcessorNode.connect(t.audioContext.destination),t.realtimeAnalyzerNode.port.addEventListener("message",t.onMessage.bind(t)),t.realtimeAnalyzerNode.port.start(),t.scriptProcessorNode.addEventListener("audioprocess",t.onAudioProcess.bind(t)),[2]}}))}))()}},{key:"onMessage",value:function(e){console.log(e),"BPM"===e.data.message&&e.data.result.bpm.length>1&&(this.setState({firstCandidateTempo:e.data.result.bpm[0].tempo}),this.setState({firstCandidateCount:e.data.result.bpm[0].count}),this.setState({secondCandidateTempo:e.data.result.bpm[1].tempo}),this.setState({secondCandidateCount:e.data.result.bpm[1].count}))}},{key:"onAudioProcess",value:function(){var e=this;v()((function(){e.analyzer.getByteFrequencyData(e.state.dataArray),e.setState((function(e){return e})),e.graph.current.drawFrequencyBarGraph()}))}},{key:"toggleCollapse",value:function(){this.setState((function(e){return e.open=!e.open,e}))}},{key:"render",value:function(){return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(p(),{children:[(0,l.jsx)("title",{children:"Microphone usage example | Realtime Bpm Analyzer"}),(0,l.jsx)("meta",{name:"description",content:"Example using the Microphone (UserMedia) of the user. Detect the BPM arround you !"})]}),(0,l.jsxs)(d.Z,{className:"pt-3",children:[(0,l.jsx)("h1",{children:"User Media"}),(0,l.jsxs)("div",{className:"lead",children:["Exemple of the usage of the analyzer with a ",(0,l.jsx)("code",{children:"MediaStreamSource"})," (microphone)."]}),(0,l.jsx)("hr",{}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",style:this.state.isRecording?{}:{display:"none"},onClick:this.stopRecording,children:[(0,l.jsx)("i",{className:"bi bi-record-fill"})," Stop Recording"]}),(0,l.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",style:this.state.isRecording?{display:"none"}:{},onClick:this.listenMicrophone,children:[(0,l.jsx)("i",{className:"bi bi-soundwave"})," Detect BPM with your Microphone"]}),(0,l.jsx)("br",{}),(0,l.jsx)("small",{className:"text-muted","aria-expanded":this.state.open,"aria-controls":"help",onClick:this.toggleCollapse,children:"More info"})]}),(0,l.jsx)(h.Z,{in:this.state.open,children:(0,l.jsx)("div",{id:"help",children:(0,l.jsxs)("div",{className:"alert alert-dark",children:["Start the experiment by clicking the button above, then you may have an alert to allow access to your microphone.",(0,l.jsx)("br",{}),"If you do not have the alert, it means either that you already gave access to it or you have an issue with your material.",(0,l.jsx)("br",{}),(0,l.jsx)("hr",{}),"You can emulate the behaviour of a microphone by looping back your output as an input to your machine to detect BPM of what you're listening right now.",(0,l.jsxs)("ul",{children:[(0,l.jsxs)("li",{children:["On Windows envrionment Enable the ",(0,l.jsx)("strong",{children:"stereoMix"})," in your audio params to emulate the behaviour of a micro."]}),(0,l.jsxs)("li",{children:["On MacOS you can use ",(0,l.jsx)("em",{children:"LoopBack"})," to put the output of Chrome on your micro input."]})]})]})})})]}),(0,l.jsx)(b.Z,{ref:this.graph,bufferLength:this.bufferLength,dataArray:this.state.dataArray}),(0,l.jsx)(d.Z,{children:(0,l.jsx)("div",{className:"d-flex justify-content-center pt-5 pb-5",children:(0,l.jsx)("div",{className:"card bg-dark col-lg-6 col-md-8 col-sm-10",children:(0,l.jsxs)("div",{className:"card-body text-center",children:[(0,l.jsxs)("span",{className:"display-6",children:[(0,l.jsxs)("span",{children:["First Candidate BPM ",this.state.firstCandidateTempo]}),(0,l.jsx)("br",{}),(0,l.jsxs)("span",{className:"text-muted",children:["Second Candidate BPM ",this.state.secondCandidateTempo]}),(0,l.jsx)("br",{}),(0,l.jsx)("i",{className:"bi bi-soundwave"}),(0,l.jsx)("br",{}),(0,l.jsxs)("span",{className:"text-muted",children:["Current Threshold ",this.state.formattedCurrentThreshold]})]}),(0,l.jsx)("br",{}),(0,l.jsx)("small",{className:"text-muted",children:"High threshold (between 0.30 and 0.90) means stable BPM."}),(0,l.jsx)("br",{}),(0,l.jsxs)("small",{className:"text-muted",children:["First Candidate Count ",this.state.firstCandidateCount]}),(0,l.jsx)("br",{}),(0,l.jsxs)("small",{className:"text-muted",children:["Second Candidate Count ",this.state.secondCandidateCount]})]})})})})]})}}]),n}(f.Component)},7663:function(e){!function(){var t={229:function(e){var t,n,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"===typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var s,c=[],u=!1,l=-1;function d(){u&&s&&(u=!1,s.length?c=s.concat(c):l=-1,c.length&&h())}function h(){if(!u){var e=i(d);u=!0;for(var t=c.length;t;){for(s=c,c=[];++l<t;)s&&s[l].run();l=-1,t=c.length}s=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||i(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}},i=!0;try{t[e](a,a.exports,r),i=!1}finally{i&&delete n[e]}return a.exports}r.ab="//";var o=r(229);e.exports=o}()},75:function(e,t,n){var r=n(3454);(function(){var t,n,o,a,i,s;"undefined"!==typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!==typeof r&&null!==r&&r.hrtime?(e.exports=function(){return(t()-i)/1e6},n=r.hrtime,a=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),s=1e9*r.uptime(),i=a-s):Date.now?(e.exports=function(){return Date.now()-o},o=Date.now()):(e.exports=function(){return(new Date).getTime()-o},o=(new Date).getTime())}).call(this)},4087:function(e,t,n){for(var r=n(75),o="undefined"===typeof window?n.g:window,a=["moz","webkit"],i="AnimationFrame",s=o["request"+i],c=o["cancel"+i]||o["cancelRequest"+i],u=0;!s&&u<a.length;u++)s=o[a[u]+"Request"+i],c=o[a[u]+"Cancel"+i]||o[a[u]+"CancelRequest"+i];if(!s||!c){var l=0,d=0,h=[];s=function(e){if(0===h.length){var t=r(),n=Math.max(0,16.666666666666668-(t-l));l=n+t,setTimeout((function(){var e=h.slice(0);h.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(l)}catch(n){setTimeout((function(){throw n}),0)}}),Math.round(n))}return h.push({handle:++d,callback:e,cancelled:!1}),d},c=function(e){for(var t=0;t<h.length;t++)h[t].handle===e&&(h[t].cancelled=!0)}}e.exports=function(e){return s.call(o,e)},e.exports.cancel=function(){c.apply(o,arguments)},e.exports.polyfill=function(e){e||(e=o),e.requestAnimationFrame=s,e.cancelAnimationFrame=c}},6174:function(e,t,n){"use strict";n.d(t,{q:function(){return o}});var r=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{s(n.next(e))}catch(t){o(t)}},i=e=>{try{s(n.throw(e))}catch(t){o(t)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,i);s((n=n.apply(e,t)).next())}));function o(e){return r(this,null,(function*(){const t=yield function(e,t){return r(this,null,(function*(){try{yield e.audioWorklet.addModule(`./${t}.js`);return new AudioWorkletNode(e,t)}catch(n){throw console.log(n),n}}))}(e,"realtime-bpm-processor");return yield e.resume(),t}))}},7568:function(e,t,n){"use strict";function r(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var i=e.apply(t,n);function s(e){r(i,o,a,s,c,"next",e)}function c(e){r(i,o,a,s,c,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return o}})}},function(e){e.O(0,[774,888,179],(function(){return t=337,e(e.s=t);var t}));var t=e.O();_N_E=t}]);