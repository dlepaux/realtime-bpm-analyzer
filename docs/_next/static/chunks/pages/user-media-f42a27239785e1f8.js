(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[220],{7465:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/user-media",function(){return n(1348)}])},2963:function(e,t,n){"use strict";var r=n(5893),o=n(7294);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return!t||"object"!==u(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=i(e);if(t){var o=i(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}var d=100,h=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(u,e);var t,n,i,s=l(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=s.call(this,e)).canvas=o.createRef(),t.bufferLength=e.bufferLength,t.dataArray=e.dataArray,t.state={parentWidth:200},t}return t=u,(n=[{key:"componentDidMount",value:function(){this.setState({parentWidth:this.canvas.current.parentNode.offsetWidth})}},{key:"componentDidUpdate",value:function(e){var t=e.bufferLength,n=e.dataArray;this.bufferLength=t,this.dataArray=n}},{key:"drawFrequencyBarGraph",value:function(){console.log("drawFrequencyBarGraph");var e=this.canvas.current.getContext("2d"),t=this.canvas.current.parentNode.offsetWidth;e.clearRect(0,0,t,d),e.fillStyle="#212529",e.fillRect(0,0,t,d);for(var n,r=t/this.bufferLength*2.5,o=0,a=0;a<this.bufferLength;a++)n=this.dataArray[a]/2,e.fillStyle="rgba(100, 206, 170, ".concat((n/d).toFixed(2),")"),e.fillRect(o,d-n/2,r,n),o+=r+1}},{key:"render",value:function(){return(0,r.jsx)("div",{className:"canvas-container bg-dark",children:(0,r.jsx)("canvas",{ref:this.canvas,height:d,width:this.state.parentWidth})})}}])&&a(t.prototype,n),i&&a(t,i),u}(o.Component);t.Z=h},1348:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var r=n(5666),o=n.n(r),a=n(5893),i=n(682),s=n(6518),c=n(7294),u=n(9008),l=n(4087),d=n.n(l),h=n(6616),f=n(2963),p=n(6308);function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,o)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){m(a,r,o,i,s,"next",e)}function s(e){m(a,r,o,i,s,"throw",e)}i(void 0)}))}}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return!t||"object"!==C(t)&&"function"!==typeof t?y(e):t}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var C=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=x(e);if(t){var o=x(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return g(this,n)}}var S=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(m,e);var t,n,r,l=w(m);function m(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),(t=l.call(this,e)).music=c.createRef(null),t.graph=c.createRef(null),t.analyzer=null,t.bufferLength=null,t.audioContext=null,t.mediaStreamSource=null,t.scriptProcessorNode=null,t.realTimeBPMAnalyzer=null,t.stream=null,t.state={open:!1,isRecording:!1,dataArray:null,firstCandidateTempo:0,firstCandidateCount:0,secondCandidateTempo:0,secondCandidateCount:0},t.onAudioProcess=t.onAudioProcess.bind(y(t)),t.stopRecording=t.stopRecording.bind(y(t)),t.listenMicrophone=t.listenMicrophone.bind(y(t)),t.toggleCollapse=t.toggleCollapse.bind(y(t)),t}return t=m,(n=[{key:"listenMicrophone",value:function(){return b(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,this.audioContext=this.audioContext||p.kq(),e.next=4,this.audioContext.resume();case 4:this.state.isRecording=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){t.stream=e,t.onStream(e)})).catch((function(e){console.error(e)}));case 6:case"end":return e.stop()}}),e,this)})).bind(this))()}},{key:"stopRecording",value:function(){return b(o().mark((function e(){var t,n,r,a,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({isRecording:!1}),!this.audioContext){e.next=4;break}return e.next=4,this.audioContext.suspend();case 4:if(this.scriptProcessorNode&&this.scriptProcessorNode.removeEventListener("audioprocess",this.onAudioProcess),this.realTimeBPMAnalyzer=null,this.stream){e.next=8;break}return e.abrupt("return");case 8:for(t=!0,n=!1,r=void 0,e.prev=9,a=this.stream.getTracks()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)"live"===(s=i.value).readyState&&s.stop();e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),n=!0,r=e.t0;case 17:e.prev=17,e.prev=18,t||null==a.return||a.return();case 20:if(e.prev=20,!n){e.next=23;break}throw r;case 23:return e.finish(20);case 24:return e.finish(17);case 25:case"end":return e.stop()}}),e,this,[[9,13,17,25],[18,,20,24]])})).bind(this))()}},{key:"onStream",value:function(e){return b(o().mark((function t(){var n,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this,r=this,t.next=3,this.audioContext.resume();case 3:this.analyzer=this.audioContext.createAnalyser(),this.analyzer.fftSize=1024,this.bufferLength=this.analyzer.frequencyBinCount,this.setState({dataArray:new Uint8Array(this.bufferLength)}),this.mediaStreamSource=this.audioContext.createMediaStreamSource(e),this.scriptProcessorNode=this.audioContext.createScriptProcessor(4096,1,1),this.mediaStreamSource.connect(this.analyzer),this.mediaStreamSource.connect(this.scriptProcessorNode),this.scriptProcessorNode.connect(this.audioContext.destination),this.realTimeBPMAnalyzer=new h.Y({debug:!0,scriptNode:{bufferSize:4096},continuousAnalysis:!0,pushTime:1e3,pushCallback:function(e,t,r){e?console.warn(e):t&&t.length>0&&(n.setState({firstCandidateTempo:t[0].tempo}),n.setState({firstCandidateCount:t[0].count}),n.setState({secondCandidateTempo:t[1].tempo}),n.setState({secondCandidateCount:t[1].count}))},onBpmStabilized:function(e){r.realTimeBPMAnalyzer.clearValidPeaks(e)}}),this.scriptProcessorNode.addEventListener("audioprocess",this.onAudioProcess.bind(this));case 14:case"end":return t.stop()}}),t,this)})).bind(this))()}},{key:"onAudioProcess",value:function(e){var t=this;this.realTimeBPMAnalyzer.analyze(e),d()((function(){t.analyzer.getByteFrequencyData(t.state.dataArray),t.setState((function(e){return e})),t.graph.current.drawFrequencyBarGraph()}))}},{key:"toggleCollapse",value:function(){this.setState((function(e){return e.open=!e.open,e}))}},{key:"render",value:function(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(u.default,{children:[(0,a.jsx)("title",{children:"Microphone usage example | Realtime Bpm Analyzer"}),(0,a.jsx)("meta",{name:"description",content:"Example using the Microphone (UserMedia) of the user. Detect the BPM arround you !"})]}),(0,a.jsxs)(i.Z,{className:"pt-3",children:[(0,a.jsx)("h1",{children:"User Media"}),(0,a.jsxs)("div",{className:"lead",children:["Exemple of the usage of the analyzer with a ",(0,a.jsx)("code",{children:"MediaStreamSource"})," (microphone)."]}),(0,a.jsx)("hr",{}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",style:this.state.isRecording?{}:{display:"none"},onClick:this.stopRecording,children:[(0,a.jsx)("i",{className:"bi bi-record-fill"})," Stop Recording"]}),(0,a.jsxs)("button",{type:"button",className:"btn btn-lg btn-primary",style:this.state.isRecording?{display:"none"}:{},onClick:this.listenMicrophone,children:[(0,a.jsx)("i",{className:"bi bi-soundwave"})," Detect BPM with your Microphone"]}),(0,a.jsx)("br",{}),(0,a.jsx)("small",{className:"text-muted","aria-expanded":this.state.open,"aria-controls":"help",onClick:this.toggleCollapse,children:"More info"})]}),(0,a.jsx)(s.Z,{in:this.state.open,children:(0,a.jsx)("div",{id:"help",children:(0,a.jsxs)("div",{className:"alert alert-dark",children:["Start the experiment by clicking the button above, then you may have an alert to allow access to your microphone.",(0,a.jsx)("br",{}),"If you do not have the alert, it means either that you already gave access to it or you have an issue with your material.",(0,a.jsx)("br",{}),(0,a.jsx)("hr",{}),"You can emulate the behaviour of a microphone by looping back your output as an input to your machine to detect BPM of what you're listening right now.",(0,a.jsxs)("ul",{children:[(0,a.jsxs)("li",{children:["On Windows envrionment Enable the ",(0,a.jsx)("strong",{children:"stereoMix"})," in your audio params to emulate the behaviour of a micro."]}),(0,a.jsxs)("li",{children:["On MacOS you can use ",(0,a.jsx)("em",{children:"LoopBack"})," to put the output of Chrome on your micro input."]})]})]})})})]}),(0,a.jsx)(f.Z,{ref:this.graph,bufferLength:this.bufferLength,dataArray:this.state.dataArray}),(0,a.jsx)(i.Z,{children:(0,a.jsx)("div",{className:"d-flex justify-content-center pt-5 pb-5",children:(0,a.jsx)("div",{className:"card bg-dark col-lg-6 col-md-8 col-sm-10",children:(0,a.jsxs)("div",{className:"card-body text-center",children:[(0,a.jsxs)("span",{className:"display-6",children:[(0,a.jsxs)("span",{children:["First Candidate BPM ",this.state.firstCandidateTempo]}),(0,a.jsx)("br",{}),(0,a.jsxs)("span",{className:"text-muted",children:["Second Candidate BPM ",this.state.secondCandidateTempo]}),(0,a.jsx)("br",{}),(0,a.jsx)("i",{className:"bi bi-soundwave"}),(0,a.jsx)("br",{}),(0,a.jsxs)("span",{className:"text-muted",children:["Current Thresold ",this.state.formattedCurrentThresold]})]}),(0,a.jsx)("br",{}),(0,a.jsx)("small",{className:"text-muted",children:"High thresold (between 0.30 and 0.90) means stable BPM."}),(0,a.jsx)("br",{}),(0,a.jsxs)("small",{className:"text-muted",children:["First Candidate Count ",this.state.firstCandidateCount]}),(0,a.jsx)("br",{}),(0,a.jsxs)("small",{className:"text-muted",children:["Second Candidate Count ",this.state.secondCandidateCount]})]})})})})]})}}])&&v(t.prototype,n),r&&v(t,r),m}(c.Component)}},function(e){e.O(0,[892,774,888,179],(function(){return t=7465,e(e.s=t);var t}));var t=e.O();_N_E=t}]);