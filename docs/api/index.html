<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding favicon -->
    

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    
    
    <script href="https://www.googletagmanager.com/gtag/js?id=G-PXQ4D05F0B" ></script>
    
    

    <!-- Adding external style-->
    
    
    <link rel="icon" href="https://dlepaux.github.io/realtime-bpm-analyzer/favicon.png" />
    
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      Home
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Home</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><ul><li class="menu-li"><a href='https://dlepaux.github.io/realtime-bpm-analyzer/' class=' menu-link' id='' target=''>Back to documentation</a></li></ul><div class="accordion collapsed" id="7326679" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=3363272><div class="accordion-heading child"><a href="Analyzer.html">Analyzer</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Analyzer.html#computeBPM">computeBPM</a></li><li data-type='method'><a href="Analyzer.html#findPeaksAtThresold">findPeaksAtThresold</a></li><li data-type='method'><a href="Analyzer.html#getLowPassSource">getLowPassSource</a></li><li data-type='method'><a href="Analyzer.html#getTopCandidates">getTopCandidates</a></li><li data-type='method'><a href="Analyzer.html#groupByTempo">groupByTempo</a></li><li data-type='method'><a href="Analyzer.html#identifyIntervals">identifyIntervals</a></li></ul></li><li class="accordion collapsed child" id=8419847><div class="accordion-heading child"><a href="RealTimeBPMAnalyzer.html">RealTimeBPMAnalyzer</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="RealTimeBPMAnalyzer.html#analyze">analyze</a></li><li data-type='method'><a href="RealTimeBPMAnalyzer.html#clearValidPeaks">clearValidPeaks</a></li><li data-type='method'><a href="RealTimeBPMAnalyzer.html#logger">logger</a></li><li data-type='method'><a href="RealTimeBPMAnalyzer.html#reset">reset</a></li></ul></li><li class="accordion collapsed child" id=4312795><div class="accordion-heading child"><a href="Utils.html">Utils</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Utils.html#generateObjectModel">generateObjectModel</a></li><li data-type='method'><a href="Utils.html#loopOnThresolds">loopOnThresolds</a></li><li data-type='method'><a href="Utils.html#noop">noop</a></li></ul></li></ul> </div></div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      

      



    









    


    <section class="readme">
        <article><h1>RealTime BPM Analyzer</h1>
<p><a href="https://github.com/xojs/xo"><img src="https://img.shields.io/badge/code_style-XO-5ed9c7.svg" alt="XO code style"></a>
<a href="https://www.npmjs.com/package/realtime-bpm-analyzer"><img src="https://img.shields.io/npm/dm/realtime-bpm-analyzer.svg" alt="npm"></a>
<a href="https://github.com/dlepaux/realtime-bpm-analyzer/blob/master/licence.md"><img src="https://img.shields.io/npm/l/realtime-bpm-analyzer.svg" alt="npm"></a>
<a href="https://github.com/dlepaux/realtime-bpm-analyzer/actions"><img src="https://github.com/dlepaux/realtime-bpm-analyzer/workflows/CI/badge.svg" alt="CI Actions Status"></a>
<a href="https://gitter.im/realtime-bpm-analyzer/Lobby?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/realtime-bpm-analyzer/Lobby.svg" alt="Join the chat at https://gitter.im/realtime-bpm-analyzer/Lobby"></a></p>
<div>
  <p align="center">
    <img src="https://dlepaux.github.io/realtime-bpm-analyzer/img/allegro-project.png" style="max-width: 100%; height: auto;">
  </p>
</div>
<h2>Documentation</h2>
<p><a href="https://dlepaux.github.io/realtime-bpm-analyzer/">See the documentation</a></p>
<p>Checkout <a href="https://github.com/dlepaux/realtime-bpm-analyzer/tree/gh-pages">gh-pages</a> branch to edit the github-pages.</p>
<p><a href="https://dlepaux.github.io/realtime-bpm-analyzer/api">See the API documentation</a></p>
<h2>Introduction</h2>
<p>This <strong>dependency free</strong> library allows you to compute the BPM (Beats Per minutes) in realtime of an <code>audio</code> / <code>video</code> node or streams thanks to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">WebAudioAPI</a>.</p>
<p>Please, note that the main use case of this tool, is to compute the BPM while the video / audio is <strong>playing</strong>.</p>
<h3>WebAudioAPI</h3>
<blockquote>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">WebAudioAPI</a> provides a powerful and versatile system for controlling audio on the Web, allowing developers to choose audio sources, add effects to audio, create audio visualizations, apply spatial effects (such as panning) and much more.</p>
</blockquote>
<h2>Motivations</h2>
<p>Allegro Project purpose is to permits you to collect the BPM of <a href="https://youtube.com">Youtube</a> musics listened by the user. Once the data collected the tool shall bind it at the begining of the title.</p>
<p>Let's imagine we are listening a <a href="https://www.youtube.com/watch?v=FYH8DsU2WCk">song</a> on Youtube. The &quot;raw&quot; title of it is: <code>New Order - Blue Monday</code>, once <code>Allegro</code> have collected the BPM it will bind it at the begining of the title, so we would have: <code>[130BPM]Â New Order - Blue Monday</code>.</p>
<p>The project is under construction thought and this component <a href="https://github.com/dlepaux/realtime-bpm-analyzer">realtime-bpm-analyzer</a> is an essential piece of the project.</p>
<h2>Installation</h2>
<p>To install this module to your project, just launch the command below:</p>
<pre class="prettyprint source lang-bash"><code>npm install realtime-bpm-analyzer
</code></pre>
<h2>Development</h2>
<pre class="prettyprint source lang-bash"><code>npm install
npx husky install
npm test
</code></pre>
<h2>Tests &amp; Coverage</h2>
<p>To launch the test suite, just launch the command below:</p>
<pre class="prettyprint source lang-bash"><code>npm test
npm run test:report
</code></pre>
<h2>Usage</h2>
<ol>
<li>
<p>An <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode">AudioNode</a> to analyze. So something like this :</p>
<pre class="prettyprint source lang-html"><code>&lt;audio src=&quot;./new_order-blue_monday.mp3&quot; id=&quot;track&quot;>&lt;/audio>
</code></pre>
</li>
<li>
<p>Connect the <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode">AudioNode</a> to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext">AudioContext</a> <strong>and</strong> create an <a href="https://developer.mozilla.org/en-US/docs/Web/API/ScriptProcessorNode">AudioContext.createScriptProcessor()</a>.</p>
<pre class="prettyprint source lang-javascript"><code>// Create new instance of AudioContext
const audioContext = new AudioContext();
// Set the source with the HTML Audio Node
const source = audioContext.createMediaElementSource(document.getElementById('track'));
// Set the scriptProcessorNode to get PCM data in real time
const scriptProcessorNode = audioContext.createScriptProcessor(4096, 1, 1);
// Connect everythings together
scriptProcessorNode.connect(audioContext.destination);
source.connect(scriptProcessorNode);
source.connect(audioContext.destination);
</code></pre>
</li>
<li>
<p>Now you have just to configure the tool and attach it to the <a href="https://developer.mozilla.org/en-US/docs/Web/Events/audioprocess">audioprocess</a> event like this :</p>
<pre class="prettyprint source lang-javascript"><code>import RealTimeBPMAnalyzer from 'realtime-bpm-analyzer';

const onAudioProcess = new RealTimeBPMAnalyzer({
    scriptNode: {
        bufferSize: 4096
    },
    pushTime: 2000,
    pushCallback: (err, bpm) => {
        console.log('bpm', bpm);
    }
});
// Attach realTime function to audioprocess event.inputBuffer (AudioBuffer)
scriptProcessorNode.onaudioprocess = (e) => {
    onAudioProcess.analyze(e);
};
</code></pre>
</li>
</ol>
<h2>Technical approch</h2>
<p>This tool has been largely inspired by the <a href="https://github.com/tornqvist/bpm-detective">Tornqvist project</a>, which is actually optimized to compute the BPM of a song as fast as possible and not during the plying.</p>
<p>The algorithm use an AudioBuffer in input. We apply on it a lowpass filter to get bass frequencies. Then, we extract raw data (PCM, Pulse Code Modulation, each points is between 1 and -1) to detect peaks.</p>
<table>
<thead>
<tr>
<th></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="https://dlepaux.github.io/realtime-bpm-analyzer/img/pcm.png" alt="pcm data" title="PCM Data"></td>
<td>PCM Data are dots with value between the max/min amplitude (1/-1). Each dots have its own index</td>
</tr>
</tbody>
</table>
<p>To detect peaks, we will test the whole AudioBuffer with a high thresold (setted to 0.9), on the amplitude axis. We need a minimum of 15 occurence to confirm a valid BPM. To find the occurencies that we need, we will decrease the thresold with a step of <code>0.05</code>.</p>
<p>When a peak is found, we will search for the next by jumping <code>10 000</code> indexes of PCM data, this means that we ignore <code>0.25</code> second of the song, in other words we simply ignore the descending phase of the peak.</p>
<p>Feel free to <a href="mailto:d.lepaux@gmail.com">contact me by mail</a> or <a href="https://gitter.im/realtime-bpm-analyzer/Lobby">join the chat</a> if you have any questions.</p>
<h2>Todo</h2>
<ul>
<li>Migrate from ScriptProcessorNode to AudioWorklet</li>
</ul>
<h2>Credits</h2>
<p>This library was been inspired from <a href="https://github.com/tornqvist/bpm-detective">Tornqvist project</a> which also based on <a href="http://joesul.li/van/beat-detection-using-web-audio/">Joe Sullivan's algorithm</a>. Thank you to both of them !</p>
<h2>Final</h2>
<p>If this project helped you in any way or if you want to support it, you can always leave me a tip here:</p>
<p>BTC <strong>36eHnxCRUDfWNFEx3YebRGw12WeutjkBBt</strong></p>
<p>ETH <strong>0x0F8b4F026624150e9F6267bFD93C372eb98e3010</strong></p></article>
    </section>






    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"Analyzer","link":"<a href=\"Analyzer.html\">Analyzer</a>"},{"title":"Analyzer#computeBPM","link":"<a href=\"Analyzer.html#computeBPM\">Analyzer &rtrif; computeBPM</a>"},{"title":"Analyzer#findPeaksAtThresold","link":"<a href=\"Analyzer.html#findPeaksAtThresold\">Analyzer &rtrif; findPeaksAtThresold</a>"},{"title":"Analyzer#getLowPassSource","link":"<a href=\"Analyzer.html#getLowPassSource\">Analyzer &rtrif; getLowPassSource</a>"},{"title":"Analyzer#getTopCandidates","link":"<a href=\"Analyzer.html#getTopCandidates\">Analyzer &rtrif; getTopCandidates</a>"},{"title":"Analyzer#groupByTempo","link":"<a href=\"Analyzer.html#groupByTempo\">Analyzer &rtrif; groupByTempo</a>"},{"title":"Analyzer#identifyIntervals","link":"<a href=\"Analyzer.html#identifyIntervals\">Analyzer &rtrif; identifyIntervals</a>"},{"title":"RealTimeBPMAnalyzer","link":"<a href=\"RealTimeBPMAnalyzer.html\">RealTimeBPMAnalyzer</a>"},{"title":"RealTimeBPMAnalyzer#analyze","link":"<a href=\"RealTimeBPMAnalyzer.html#analyze\">RealTimeBPMAnalyzer &rtrif; analyze</a>"},{"title":"RealTimeBPMAnalyzer#clearValidPeaks","link":"<a href=\"RealTimeBPMAnalyzer.html#clearValidPeaks\">RealTimeBPMAnalyzer &rtrif; clearValidPeaks</a>"},{"title":"RealTimeBPMAnalyzer#logger","link":"<a href=\"RealTimeBPMAnalyzer.html#logger\">RealTimeBPMAnalyzer &rtrif; logger</a>"},{"title":"RealTimeBPMAnalyzer#reset","link":"<a href=\"RealTimeBPMAnalyzer.html#reset\">RealTimeBPMAnalyzer &rtrif; reset</a>"},{"title":"Utils","link":"<a href=\"Utils.html\">Utils</a>"},{"title":"Utils#generateObjectModel","link":"<a href=\"Utils.html#generateObjectModel\">Utils &rtrif; generateObjectModel</a>"},{"title":"Utils#loopOnThresolds","link":"<a href=\"Utils.html#loopOnThresolds\">Utils &rtrif; loopOnThresolds</a>"},{"title":"Utils#noop","link":"<a href=\"Utils.html#noop\">Utils &rtrif; noop</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || []; function gtag() {dataLayer.push(arguments)} gtag('js', new Date()); gtag('config', 'G-PXQ4D05F0B');
    </script>
    

    

    
    <script type="text/javascript">
    window.dataLayer = window.dataLayer || []; function gtag() {dataLayer.push(arguments)} gtag('js', new Date()); gtag('config', 'G-PXQ4D05F0B');
    </script>
    

    


  </body>

</html>